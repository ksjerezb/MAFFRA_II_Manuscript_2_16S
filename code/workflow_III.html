<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>workflow part III</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="workflow_III_files/libs/clipboard/clipboard.min.js"></script>
<script src="workflow_III_files/libs/quarto-html/quarto.js"></script>
<script src="workflow_III_files/libs/quarto-html/popper.min.js"></script>
<script src="workflow_III_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="workflow_III_files/libs/quarto-html/anchor.min.js"></script>
<link href="workflow_III_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="workflow_III_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="workflow_III_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="workflow_III_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="workflow_III_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">workflow part III</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="beta-diversity" class="level1">
<h1>Beta diversity</h1>
<section id="data-prep" class="level2">
<h2 class="anchored" data-anchor-id="data-prep">Data prep</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#estimating relative abundance on rarefied data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># allday = prune_taxa(taxa_sums(ps.rarefied) &gt; 0, ps.rarefied)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># minTotRelAbun = 0</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># x = taxa_sums(allday)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># keepTaxa = taxa_names(allday)[which((x / sum(x)) &gt; minTotRelAbun)]</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># allday &lt;- prune_taxa(keepTaxa, allday)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># tax_table(allday) &lt;- tax_table(allday)[,1:6]</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>allday1 <span class="ot">=</span> <span class="fu">prune_taxa</span>(<span class="fu">taxa_sums</span>(allday1) <span class="sc">&gt;</span> <span class="dv">0</span>, allday1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>pick_new_outgroup <span class="ot">&lt;-</span> <span class="cf">function</span>(tree.unrooted){</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">"magrittr"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">"data.table"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">"ape"</span>) <span class="co"># ape::Ntip</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># tablify parts of tree that we need.</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>treeDT <span class="ot">&lt;-</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">cbind</span>(</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>         <span class="fu">data.table</span>(tree.unrooted<span class="sc">$</span>edge),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>         <span class="fu">data.table</span>(<span class="at">length =</span> tree.unrooted<span class="sc">$</span>edge.length)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>     )[<span class="dv">1</span><span class="sc">:</span><span class="fu">Ntip</span>(tree.unrooted)] <span class="sc">%&gt;%</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a> <span class="fu">cbind</span>(<span class="fu">data.table</span>(<span class="at">id =</span> tree.unrooted<span class="sc">$</span>tip.label))</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a> <span class="co"># Take the longest terminal branch as outgroup</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a> new.outgroup <span class="ot">&lt;-</span> treeDT[<span class="fu">which.max</span>(length)]<span class="sc">$</span>id</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(new.outgroup) }</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>my.tree <span class="ot">&lt;-</span> <span class="fu">phy_tree</span>(allday1)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>out.group <span class="ot">&lt;-</span> <span class="fu">pick_new_outgroup</span>(my.tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: magrittr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'magrittr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    set_names</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tidyr':

    extract</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: data.table</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'data.table'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:lubridate':

    hour, isoweek, mday, minute, month, quarter, second, wday, week,
    yday, year</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    between, first, last</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    transpose</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: ape</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'ape'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    where</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>out.group <span class="do">## [1] "Seq5638"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Seq5638"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>new.tree <span class="ot">&lt;-</span> ape<span class="sc">::</span><span class="fu">root</span>(my.tree, <span class="at">outgroup=</span>out.group, <span class="at">resolve.root=</span><span class="cn">TRUE</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">phy_tree</span>(allday1) <span class="ot">&lt;-</span> new.tree</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">phy_tree</span>(allday1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Phylogenetic tree with 2444 tips and 2443 internal nodes.

Tip labels:
  Seq67, Seq68, Seq69, Seq70, Seq76, Seq79, ...
Node labels:
  Root, , 0.959, 0.729, 0.702, 0.912, ...

Rooted; includes branch lengths.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span>  <span class="fu">as.data.frame</span>(<span class="fu">otu_table</span>(allday1))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>sams <span class="ot">&lt;-</span> <span class="fu">colnames</span>(d1)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>saminfo<span class="sc">$</span>SampleID <span class="ot">&lt;-</span>  <span class="fu">rownames</span>(saminfo)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>saminfo <span class="ot">&lt;-</span> saminfo <span class="sc">%&gt;%</span> <span class="fu">relocate</span>(SampleID)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> saminfo <span class="sc">%&gt;%</span>  <span class="fu">filter</span>(SampleID <span class="sc">%in%</span> sams)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>saminfo<span class="ot">=</span>d2</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>d3 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(phyloseq<span class="sc">::</span><span class="fu">tax_table</span>(allday1))</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>d3<span class="sc">$</span>Genus<span class="ot">=</span><span class="fu">recode</span>(d3<span class="sc">$</span>Genus,<span class="st">"NA"</span><span class="ot">=</span><span class="st">"Unclassified bacteria"</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">amp_load</span>(</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">otutable =</span> d1,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">metadata =</span> d2,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">taxonomy =</span> d3,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">tree =</span> new.tree</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Could not find a column named OTU/ASV in otutable, using rownames as
OTU ID's</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Could not find a column named OTU/ASV in taxonomy, using rownames as
OTU ID's</code></pre>
</div>
</div>
</section>
<section id="sampling-effort-correction-comparison" class="level2">
<h2 class="anchored" data-anchor-id="sampling-effort-correction-comparison">Sampling effort correction comparison</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">##allday is the rarefy dataset</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># allday1 &lt;- subset_samples(allday1, PigID %in% my_pigs)</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>wunifrac_dist <span class="ot">=</span> phyloseq<span class="sc">::</span><span class="fu">distance</span>(allday1, <span class="at">method=</span><span class="st">"unifrac"</span>, <span class="at">weighted=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#comparing distances</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                                          </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>group_count <span class="ot">&lt;-</span> ps1.NON_rare<span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">psmelt</span>()<span class="sc">%&gt;%</span> <span class="co"># Melt to long format</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sample,OTU,Abundance)<span class="sc">%&gt;%</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Sample) <span class="sc">%&gt;%</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n_seqs =</span> <span class="fu">sum</span>(Abundance))</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>group_count<span class="sc">$</span>n_seqs <span class="sc">%&gt;%</span> range</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  40676 105906</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>rand_df <span class="ot">&lt;-</span> ps1.NON_rare<span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">psmelt</span>()<span class="sc">%&gt;%</span> <span class="co"># Melt to long format</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sample,OTU,Abundance)<span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>OTU, <span class="at">values_from=</span>Abundance, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(rand_df) <span class="ot">&lt;-</span> rand_df<span class="sc">$</span>Sample</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>rand_df <span class="ot">&lt;-</span> rand_df[,<span class="sc">-</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>ps_clr <span class="ot">&lt;-</span> microbiome<span class="sc">::</span><span class="fu">transform</span>(ps1.NON_rare, <span class="st">"clr"</span>)          </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># phyloseq::otu_table(ps1.NON_rare)[1:5, 1:5]</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># phyloseq::otu_table(ps_clr)[1:5, 1:5]</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>rclr_df <span class="ot">&lt;-</span> ps_clr<span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">psmelt</span>()<span class="sc">%&gt;%</span> <span class="co"># Melt to long format</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()<span class="sc">%&gt;%</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(OTU,Sample,Abundance) <span class="sc">%&gt;%</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>OTU, <span class="at">values_from=</span>Abundance, <span class="at">values_fill=</span><span class="fu">list</span>(<span class="at">Value =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(rclr_df) <span class="ot">&lt;-</span> rclr_df<span class="sc">$</span>Sample</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>rclr_df <span class="ot">&lt;-</span> rclr_df[,<span class="sc">-</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>norare_dist <span class="ot">&lt;-</span> <span class="fu">vegdist</span>(rand_df, <span class="at">method=</span><span class="st">"euclidean"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>rare_dist <span class="ot">&lt;-</span> <span class="fu">avgdist</span>(rand_df, <span class="at">dmethod=</span><span class="st">"euclidean"</span>, <span class="at">sample=</span><span class="fu">min</span>(group_count<span class="sc">$</span>n_seqs))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>rclr_dist <span class="ot">&lt;-</span> <span class="fu">vegdist</span>(rclr_df, <span class="at">method=</span><span class="st">"euclidean"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>wunifrac_dist_tb <span class="ot">&lt;-</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  wunifrac_dist <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  as.matrix <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"sample"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="sc">-</span>sample) <span class="sc">%&gt;%</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">&lt;</span> sample)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>norare_dtbl <span class="ot">&lt;-</span> norare_dist <span class="sc">%&gt;%</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  as.matrix <span class="sc">%&gt;%</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"sample"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="sc">-</span>sample) <span class="sc">%&gt;%</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">&lt;</span> sample)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>rare_dtbl <span class="ot">&lt;-</span> rare_dist <span class="sc">%&gt;%</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  as.matrix <span class="sc">%&gt;%</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"sample"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="sc">-</span>sample) <span class="sc">%&gt;%</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">&lt;</span> sample)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>rclr_dtbl <span class="ot">&lt;-</span> rclr_dist <span class="sc">%&gt;%</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  as.matrix <span class="sc">%&gt;%</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"sample"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="sc">-</span>sample) <span class="sc">%&gt;%</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">&lt;</span> sample)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(norare_dtbl, rare_dtbl, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"sample"</span>, <span class="st">"name"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(., rclr_dtbl, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"sample"</span>, <span class="st">"name"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(., wunifrac_dist_tb, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"sample"</span>, <span class="st">"name"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(., group_count, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"sample"</span> <span class="ot">=</span> <span class="st">"Sample"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(., group_count, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"name"</span> <span class="ot">=</span> <span class="st">"Sample"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diffs =</span> <span class="fu">abs</span>(n_seqs.x <span class="sc">-</span> n_seqs.y)) <span class="sc">%&gt;%</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sample, name, <span class="at">norare=</span>value.x, <span class="at">rare=</span>value.y, <span class="at">rclr=</span>value.x.x, <span class="at">wuni=</span>value.y.y, diffs) <span class="sc">%&gt;%</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">c</span>(norare, rare, rclr, wuni), <span class="at">names_to=</span><span class="st">"method"</span>, <span class="at">values_to=</span><span class="st">"dist"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>diffs, <span class="at">y=</span>dist)) <span class="sc">+</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">nrow=</span><span class="dv">4</span>, <span class="at">scales=</span><span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="workflow_III_files/figure-html/plot_dist-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>saminfo <span class="ot">&lt;-</span> saminfo <span class="sc">%&gt;%</span> <span class="fu">mutate_at</span>(<span class="fu">names</span>(saminfo)[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>], as.factor)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>saminfo<span class="sc">$</span>Source_treat<span class="ot">=</span><span class="fu">interaction</span>(saminfo<span class="sc">$</span>Source,saminfo<span class="sc">$</span>treat)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">#run and saved </span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># nmds1 &lt;- metaMDS(wunifrac_dist,k=2, trymax=300, maxit = 2000, smin = 1e-4, sfgrmin = 1e-11, sratmax= 0.99999)</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># nmds2 &lt;- metaMDS(norare_dist,k=2, trymax=2000, maxit = 2000, smin = 1e-4, sfgrmin = 1e-11, sratmax= 0.99999)</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co"># nmds3 &lt;- metaMDS(rare_dist,k=2, trymax=500, maxit = 2000, smin = 1e-4, sfgrmin = 1e-11, sratmax= 0.99999)</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># nmds4 &lt;- metaMDS(rclr_dist)</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(nmds1, "nmds1.rds")</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(nmds2, "nmds2.rds")</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(nmds3, "nmds3.rds")</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(nmds4, "nmds4.rds")</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>nmds1 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"nmds1.rds"</span>)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>nmds2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"nmds2.rds"</span>)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>nmds3 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"nmds3.rds"</span>)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>nmds4 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"nmds4.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="nmds--w-unifrac-distance-b-diversity" class="level3">
<h3 class="anchored" data-anchor-id="nmds--w-unifrac-distance-b-diversity">NMDS -W Unifrac distance B diversity</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># stress &lt;- nmds$stress</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>metadata_nmds <span class="ot">&lt;-</span> vegan<span class="sc">::</span><span class="fu">scores</span>(nmds1, <span class="at">display=</span><span class="st">"site"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"samples"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span> (., saminfo, <span class="at">by=</span> <span class="fu">join_by</span>(samples <span class="sc">==</span> SampleID))</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>centroid <span class="ot">&lt;-</span> metadata_nmds <span class="sc">%&gt;%</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treat, Source) <span class="sc">%&gt;%</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">NMDS1=</span><span class="fu">mean</span>(NMDS1), <span class="at">NMDS2=</span><span class="fu">mean</span>(NMDS2))</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>beta_plot<span class="ot">=</span>metadata_nmds <span class="sc">%&gt;%</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>NMDS1, <span class="at">y=</span>NMDS2, <span class="at">color=</span>treat)) <span class="sc">+</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">show.legend=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>centroid, <span class="at">size=</span><span class="dv">3</span>, <span class="at">shape=</span><span class="dv">21</span>, <span class="at">color=</span><span class="st">"black"</span>,</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">fill=</span>treat), <span class="at">show.legend=</span><span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal)<span class="sc">+</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> mypal)<span class="sc">+</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Source, <span class="at">nrow=</span><span class="dv">6</span>)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>beta_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in MASS::cov.trob(data[, vars]): Probable convergence failure</code></pre>
</div>
<div class="cell-output-display">
<p><img src="workflow_III_files/figure-html/w_unifrac-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(wunifrac_dist<span class="sc">~</span>saminfo<span class="sc">$</span>treat<span class="sc">*</span>saminfo<span class="sc">$</span>Source,</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>PigID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for adonis under reduced model
Terms added sequentially (first to last)
Blocks:  strata 
Permutation: free
Number of permutations: 999

adonis2(formula = wunifrac_dist ~ saminfo$treat * saminfo$Source, strata = saminfo$PigID)
                              Df SumOfSqs      R2       F Pr(&gt;F)    
saminfo$treat                  3   0.0699 0.02073  1.4311  0.001 ***
saminfo$Source                 5   0.8574 0.25417 10.5289  0.001 ***
saminfo$treat:saminfo$Source  15   0.1496 0.04436  0.6126  0.953    
Residual                     141   2.2963 0.68074                   
Total                        164   3.3732 1.00000                   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(wunifrac_dist<span class="sc">~</span>saminfo<span class="sc">$</span>Source,</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>PigID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for adonis under reduced model
Terms added sequentially (first to last)
Blocks:  strata 
Permutation: free
Number of permutations: 999

adonis2(formula = wunifrac_dist ~ saminfo$Source, strata = saminfo$PigID)
                Df SumOfSqs     R2      F Pr(&gt;F)    
saminfo$Source   5   0.8588 0.2546 10.862  0.001 ***
Residual       159   2.5144 0.7454                  
Total          164   3.3732 1.0000                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(wunifrac_dist<span class="sc">~</span>saminfo<span class="sc">$</span>treat,</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>batch)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for adonis under reduced model
Terms added sequentially (first to last)
Blocks:  strata 
Permutation: free
Number of permutations: 999

adonis2(formula = wunifrac_dist ~ saminfo$treat, strata = saminfo$batch)
               Df SumOfSqs      R2      F Pr(&gt;F)
saminfo$treat   3   0.0699 0.02073 1.1359  0.307
Residual      161   3.3033 0.97927              
Total         164   3.3732 1.00000              </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(wunifrac_dist, saminfo<span class="sc">$</span>Source)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: Distances
           Df  Sum Sq   Mean Sq F value  Pr(&gt;F)  
Groups      5 0.02342 0.0046839   1.958 0.08775 .
Residuals 159 0.38036 0.0023922                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 999

Response: Distances
           Df  Sum Sq   Mean Sq     F N.Perm Pr(&gt;F)  
Groups      5 0.02342 0.0046839 1.958    999  0.092 .
Residuals 159 0.38036 0.0023922                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(wunifrac_dist, saminfo<span class="sc">$</span>treat)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: Distances
           Df  Sum Sq   Mean Sq F value Pr(&gt;F)
Groups      3 0.01234 0.0041129  1.9477  0.124
Residuals 161 0.33997 0.0021116               </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 999

Response: Distances
           Df  Sum Sq   Mean Sq      F N.Perm Pr(&gt;F)
Groups      3 0.01234 0.0041129 1.9477    999  0.126
Residuals 161 0.33997 0.0021116                     </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(wunifrac_dist, saminfo<span class="sc">$</span>Source_treat)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: Distances
           Df  Sum Sq   Mean Sq F value  Pr(&gt;F)  
Groups     23 0.09948 0.0043253  1.8269 0.01784 *
Residuals 141 0.33382 0.0023675                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 999

Response: Distances
           Df  Sum Sq   Mean Sq      F N.Perm Pr(&gt;F)  
Groups     23 0.09948 0.0043253 1.8269    999  0.017 *
Residuals 141 0.33382 0.0023675                       
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="nmds--non-rarefy-euclidean-distance-diversity" class="level3">
<h3 class="anchored" data-anchor-id="nmds--non-rarefy-euclidean-distance-diversity">NMDS -Non rarefy euclidean distance diversity</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co"># stress &lt;- nmds$stress</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>metadata_nmds <span class="ot">&lt;-</span> vegan<span class="sc">::</span><span class="fu">scores</span>(nmds2, <span class="at">display=</span><span class="st">"site"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"samples"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span> (., saminfo, <span class="at">by=</span> <span class="fu">join_by</span>(samples <span class="sc">==</span> SampleID))</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>centroid <span class="ot">&lt;-</span> metadata_nmds <span class="sc">%&gt;%</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treat, Source) <span class="sc">%&gt;%</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">NMDS1=</span><span class="fu">mean</span>(NMDS1), <span class="at">NMDS2=</span><span class="fu">mean</span>(NMDS2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'treat'. You can override using the
`.groups` argument.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>metadata_nmds <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>NMDS1, <span class="at">y=</span>NMDS2, <span class="at">color=</span>treat)) <span class="sc">+</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">show.legend=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>centroid, <span class="at">size=</span><span class="dv">3</span>, <span class="at">shape=</span><span class="dv">21</span>, <span class="at">color=</span><span class="st">"black"</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">fill=</span>treat), <span class="at">show.legend=</span><span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal)<span class="sc">+</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> mypal)<span class="sc">+</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Source, <span class="at">nrow=</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Too few points to calculate an ellipse</code></pre>
</div>
<div class="cell-output-display">
<p><img src="workflow_III_files/figure-html/non_rare_eucl-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(norare_dist<span class="sc">~</span>saminfo<span class="sc">$</span>treat<span class="sc">*</span>saminfo<span class="sc">$</span>Source,</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>PigID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for adonis under reduced model
Terms added sequentially (first to last)
Blocks:  strata 
Permutation: free
Number of permutations: 999

adonis2(formula = norare_dist ~ saminfo$treat * saminfo$Source, strata = saminfo$PigID)
                              Df    SumOfSqs      R2       F Pr(&gt;F)    
saminfo$treat                  3   454273198 0.00959  0.7028  0.001 ***
saminfo$Source                 5 11802310705 0.24907 10.9551  0.001 ***
saminfo$treat:saminfo$Source  15  4747528081 0.10019  1.4689  0.004 ** 
Residual                     141 30380869571 0.64115                   
Total                        164 47384981556 1.00000                   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(norare_dist<span class="sc">~</span>saminfo<span class="sc">$</span>Source,</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>PigID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for adonis under reduced model
Terms added sequentially (first to last)
Blocks:  strata 
Permutation: free
Number of permutations: 999

adonis2(formula = norare_dist ~ saminfo$Source, strata = saminfo$PigID)
                Df    SumOfSqs      R2      F Pr(&gt;F)    
saminfo$Source   5 11837428411 0.24981 10.589  0.001 ***
Residual       159 35547553145 0.75019                  
Total          164 47384981556 1.00000                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(norare_dist<span class="sc">~</span>saminfo<span class="sc">$</span>treat,</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>batch)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for adonis under reduced model
Terms added sequentially (first to last)
Blocks:  strata 
Permutation: free
Number of permutations: 999

adonis2(formula = norare_dist ~ saminfo$treat, strata = saminfo$batch)
               Df    SumOfSqs      R2      F Pr(&gt;F)
saminfo$treat   3   454273198 0.00959 0.5195  0.786
Residual      161 46930708357 0.99041              
Total         164 47384981556 1.00000              </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(norare_dist, saminfo<span class="sc">$</span>Source)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: Distances
           Df     Sum Sq  Mean Sq F value Pr(&gt;F)
Groups      5  215172371 43034474  0.7662 0.5754
Residuals 159 8930258330 56165147               </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 999

Response: Distances
           Df     Sum Sq  Mean Sq      F N.Perm Pr(&gt;F)
Groups      5  215172371 43034474 0.7662    999  0.599
Residuals 159 8930258330 56165147                     </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(norare_dist, saminfo<span class="sc">$</span>treat)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: Distances
           Df      Sum Sq  Mean Sq F value Pr(&gt;F)
Groups      3    81849541 27283180  0.3377 0.7981
Residuals 161 13006633674 80786545               </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 999

Response: Distances
           Df      Sum Sq  Mean Sq      F N.Perm Pr(&gt;F)
Groups      3    81849541 27283180 0.3377    999  0.805
Residuals 161 13006633674 80786545                     </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(norare_dist, saminfo<span class="sc">$</span>Source_treat)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: Distances
           Df     Sum Sq  Mean Sq F value Pr(&gt;F)
Groups     23 1185653633 51550158  1.0358 0.4258
Residuals 141 7017180752 49767239               </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 999

Response: Distances
           Df     Sum Sq  Mean Sq      F N.Perm Pr(&gt;F)
Groups     23 1185653633 51550158 1.0358    999  0.408
Residuals 141 7017180752 49767239                     </code></pre>
</div>
</div>
</section>
<section id="nmds--rarefy-euclidean-distance-diversity" class="level3">
<h3 class="anchored" data-anchor-id="nmds--rarefy-euclidean-distance-diversity">NMDS -Rarefy euclidean distance diversity</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>metadata_nmds <span class="ot">&lt;-</span> vegan<span class="sc">::</span><span class="fu">scores</span>(nmds3, <span class="at">display=</span><span class="st">"site"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"samples"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span> (., saminfo, <span class="at">by=</span> <span class="fu">join_by</span>(samples <span class="sc">==</span> SampleID))</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>centroid <span class="ot">&lt;-</span> metadata_nmds <span class="sc">%&gt;%</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treat, Source) <span class="sc">%&gt;%</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">NMDS1=</span><span class="fu">mean</span>(NMDS1), <span class="at">NMDS2=</span><span class="fu">mean</span>(NMDS2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'treat'. You can override using the
`.groups` argument.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>metadata_nmds <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>NMDS1, <span class="at">y=</span>NMDS2, <span class="at">color=</span>treat)) <span class="sc">+</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">show.legend=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>centroid, <span class="at">size=</span><span class="dv">3</span>, <span class="at">shape=</span><span class="dv">21</span>, <span class="at">color=</span><span class="st">"black"</span>,</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">fill=</span>treat), <span class="at">show.legend=</span><span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal)<span class="sc">+</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> mypal)<span class="sc">+</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Source, <span class="at">nrow=</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in MASS::cov.trob(data[, vars]): Probable convergence failure</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Too few points to calculate an ellipse</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in MASS::cov.trob(data[, vars]): Probable convergence failure</code></pre>
</div>
<div class="cell-output-display">
<p><img src="workflow_III_files/figure-html/rare_eucl-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(rare_dist<span class="sc">~</span>saminfo<span class="sc">$</span>treat<span class="sc">*</span>saminfo<span class="sc">$</span>Source,</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>PigID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for adonis under reduced model
Terms added sequentially (first to last)
Blocks:  strata 
Permutation: free
Number of permutations: 999

adonis2(formula = rare_dist ~ saminfo$treat * saminfo$Source, strata = saminfo$PigID)
                              Df    SumOfSqs      R2      F Pr(&gt;F)    
saminfo$treat                  3   121144234 0.01109 0.7327  0.001 ***
saminfo$Source                 5  2002133738 0.18333 7.2652  0.001 ***
saminfo$treat:saminfo$Source  15  1026627214 0.09400 1.2418  0.003 ** 
Residual                     141  7771298583 0.71158                  
Total                        164 10921203769 1.00000                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(rare_dist<span class="sc">~</span>saminfo<span class="sc">$</span>Source,</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>PigID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for adonis under reduced model
Terms added sequentially (first to last)
Blocks:  strata 
Permutation: free
Number of permutations: 999

adonis2(formula = rare_dist ~ saminfo$Source, strata = saminfo$PigID)
                Df    SumOfSqs      R2      F Pr(&gt;F)    
saminfo$Source   5  2008307083 0.18389 7.1654  0.001 ***
Residual       159  8912896686 0.81611                  
Total          164 10921203769 1.00000                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(rare_dist<span class="sc">~</span>saminfo<span class="sc">$</span>treat,</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>batch)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for adonis under reduced model
Terms added sequentially (first to last)
Blocks:  strata 
Permutation: free
Number of permutations: 999

adonis2(formula = rare_dist ~ saminfo$treat, strata = saminfo$batch)
               Df    SumOfSqs      R2     F Pr(&gt;F)
saminfo$treat   3   121144234 0.01109 0.602  0.696
Residual      161 10800059534 0.98891             
Total         164 10921203769 1.00000             </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(rare_dist, saminfo<span class="sc">$</span>Source)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: Distances
           Df     Sum Sq  Mean Sq F value Pr(&gt;F)
Groups      5   43649992  8729998  0.7249 0.6057
Residuals 159 1914930806 12043590               </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 999

Response: Distances
           Df     Sum Sq  Mean Sq      F N.Perm Pr(&gt;F)
Groups      5   43649992  8729998 0.7249    999  0.589
Residuals 159 1914930806 12043590                     </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(rare_dist, saminfo<span class="sc">$</span>treat)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: Distances
           Df     Sum Sq  Mean Sq F value Pr(&gt;F)
Groups      3   27765659  9255220  0.6474 0.5857
Residuals 161 2301802276 14296909               </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 999

Response: Distances
           Df     Sum Sq  Mean Sq      F N.Perm Pr(&gt;F)
Groups      3   27765659  9255220 0.6474    999  0.598
Residuals 161 2301802276 14296909                     </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(rare_dist, saminfo<span class="sc">$</span>Source_treat)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: Distances
           Df     Sum Sq  Mean Sq F value Pr(&gt;F)
Groups     23  328212330 14270101  1.2756 0.1947
Residuals 141 1577392597 11187182               </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 999

Response: Distances
           Df     Sum Sq  Mean Sq      F N.Perm Pr(&gt;F)
Groups     23  328212330 14270101 1.2756    999   0.18
Residuals 141 1577392597 11187182                     </code></pre>
</div>
</div>
</section>
<section id="nmds--robust-clr-euclidean-distance-diversity" class="level3">
<h3 class="anchored" data-anchor-id="nmds--robust-clr-euclidean-distance-diversity">NMDS -Robust CLR euclidean distance diversity</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="co"># stress &lt;- nmds$stress</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>metadata_nmds <span class="ot">&lt;-</span> vegan<span class="sc">::</span><span class="fu">scores</span>(nmds4, <span class="at">display=</span><span class="st">"site"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"samples"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span> (., saminfo, <span class="at">by=</span> <span class="fu">join_by</span>(samples <span class="sc">==</span> SampleID))</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>centroid <span class="ot">&lt;-</span> metadata_nmds <span class="sc">%&gt;%</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treat, Source) <span class="sc">%&gt;%</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">NMDS1=</span><span class="fu">mean</span>(NMDS1), <span class="at">NMDS2=</span><span class="fu">mean</span>(NMDS2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'treat'. You can override using the
`.groups` argument.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>metadata_nmds <span class="sc">%&gt;%</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>NMDS1, <span class="at">y=</span>NMDS2, <span class="at">color=</span>treat)) <span class="sc">+</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">show.legend=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>centroid, <span class="at">size=</span><span class="dv">3</span>, <span class="at">shape=</span><span class="dv">21</span>, <span class="at">color=</span><span class="st">"black"</span>,</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">fill=</span>treat), <span class="at">show.legend=</span><span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal)<span class="sc">+</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> mypal)<span class="sc">+</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Source, <span class="at">nrow=</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Too few points to calculate an ellipse</code></pre>
</div>
<div class="cell-output-display">
<p><img src="workflow_III_files/figure-html/rclr_dist_not-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>beta_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Too few points to calculate an ellipse</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in MASS::cov.trob(data[, vars]): Probable convergence failure</code></pre>
</div>
<div class="cell-output-display">
<p><img src="workflow_III_files/figure-html/rclr_dist_not-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(rclr_dist<span class="sc">~</span>saminfo<span class="sc">$</span>treat<span class="sc">*</span>saminfo<span class="sc">$</span>Source,</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>PigID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for adonis under reduced model
Terms added sequentially (first to last)
Blocks:  strata 
Permutation: free
Number of permutations: 999

adonis2(formula = rclr_dist ~ saminfo$treat * saminfo$Source, strata = saminfo$PigID)
                              Df SumOfSqs      R2      F Pr(&gt;F)  
saminfo$treat                  3    21078 0.02496 1.3667  0.427  
saminfo$Source                 5    31023 0.03674 1.2070  0.043 *
saminfo$treat:saminfo$Source  15    67419 0.07985 0.8743  0.902  
Residual                     141   724824 0.85845                
Total                        164   844344 1.00000                
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(rclr_dist<span class="sc">~</span>saminfo<span class="sc">$</span>Source,</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>PigID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for adonis under reduced model
Terms added sequentially (first to last)
Blocks:  strata 
Permutation: free
Number of permutations: 999

adonis2(formula = rclr_dist ~ saminfo$Source, strata = saminfo$PigID)
                Df SumOfSqs      R2      F Pr(&gt;F)  
saminfo$Source   5    31051 0.03677 1.2141  0.035 *
Residual       159   813293 0.96323                
Total          164   844344 1.00000                
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(rclr_dist<span class="sc">~</span>saminfo<span class="sc">$</span>treat,</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>batch)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for adonis under reduced model
Terms added sequentially (first to last)
Blocks:  strata 
Permutation: free
Number of permutations: 999

adonis2(formula = rclr_dist ~ saminfo$treat, strata = saminfo$batch)
               Df SumOfSqs      R2     F Pr(&gt;F)   
saminfo$treat   3    21078 0.02496 1.374  0.007 **
Residual      161   823266 0.97504                
Total         164   844344 1.00000                
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(rclr_dist, saminfo<span class="sc">$</span>Source)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: Distances
           Df Sum Sq Mean Sq F value      Pr(&gt;F)    
Groups      5   4070  814.00   7.114 0.000004957 ***
Residuals 159  18193  114.42                        
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 999

Response: Distances
           Df Sum Sq Mean Sq     F N.Perm Pr(&gt;F)    
Groups      5   4070  814.00 7.114    999  0.001 ***
Residuals 159  18193  114.42                        
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(rclr_dist, saminfo<span class="sc">$</span>treat)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: Distances
           Df  Sum Sq Mean Sq F value Pr(&gt;F)
Groups      3   444.4  148.13  1.1539 0.3292
Residuals 161 20667.9  128.37               </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 999

Response: Distances
           Df  Sum Sq Mean Sq      F N.Perm Pr(&gt;F)
Groups      3   444.4  148.13 1.1539    999  0.324
Residuals 161 20667.9  128.37                     </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(rclr_dist, saminfo<span class="sc">$</span>Source_treat)</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: Distances
           Df Sum Sq Mean Sq F value     Pr(&gt;F)    
Groups     23   8532  370.96  3.0339 0.00003012 ***
Residuals 141  17240  122.27                       
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 999

Response: Distances
           Df Sum Sq Mean Sq      F N.Perm Pr(&gt;F)    
Groups     23   8532  370.96 3.0339    999  0.001 ***
Residuals 141  17240  122.27                         
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
</section>
<section id="ordinate-with-phyloseq" class="level2">
<h2 class="anchored" data-anchor-id="ordinate-with-phyloseq">Ordinate with Phyloseq</h2>
<section id="nmds---unifrac-dist" class="level3">
<h3 class="anchored" data-anchor-id="nmds---unifrac-dist">NMDS - Unifrac dist</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Generate distances</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>ord_unifrac <span class="ot">&lt;-</span> <span class="fu">ordinate</span>(allday1, <span class="at">method =</span> <span class="st">"NMDS"</span>, <span class="at">distance =</span> <span class="st">"wunifrac"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Run 0 stress 0.1274425 
Run 1 stress 0.1481574 
Run 2 stress 0.1764512 
Run 3 stress 0.1645016 
Run 4 stress 0.1474194 
Run 5 stress 0.1695523 
Run 6 stress 0.149983 
Run 7 stress 0.1901487 
Run 8 stress 0.1768008 
Run 9 stress 0.1552867 
Run 10 stress 0.1777153 
Run 11 stress 0.1526263 
Run 12 stress 0.177828 
Run 13 stress 0.161931 
Run 14 stress 0.1822824 
Run 15 stress 0.1600313 
Run 16 stress 0.1624988 
Run 17 stress 0.1609737 
Run 18 stress 0.185062 
Run 19 stress 0.1451111 
Run 20 stress 0.1635365 
*** No convergence -- monoMDS stopping criteria:
     1: no. of iterations &gt;= maxit
    18: stress ratio &gt; sratmax
     1: scale factor of the gradient &lt; sfgrmin</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>ord_unifrac_un <span class="ot">&lt;-</span> <span class="fu">ordinate</span>(allday1, <span class="at">method =</span> <span class="st">"NMDS"</span>, <span class="at">distance =</span> <span class="st">"unifrac"</span>)   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Run 0 stress 0.1353102 
Run 1 stress 0.1340864 
... New best solution
... Procrustes: rmse 0.005469795  max resid 0.05093152 
Run 2 stress 0.1340867 
... Procrustes: rmse 0.0001225328  max resid 0.0009652873 
... Similar to previous best
Run 3 stress 0.1350763 
Run 4 stress 0.1350973 
Run 5 stress 0.2377239 
Run 6 stress 0.1509818 
Run 7 stress 0.1351021 
Run 8 stress 0.1531424 
Run 9 stress 0.1362816 
Run 10 stress 0.154858 
Run 11 stress 0.1340864 
... Procrustes: rmse 0.00002062575  max resid 0.0001950418 
... Similar to previous best
Run 12 stress 0.1340901 
... Procrustes: rmse 0.0009746843  max resid 0.01004985 
Run 13 stress 0.1340901 
... Procrustes: rmse 0.0009635409  max resid 0.009902877 
... Similar to previous best
Run 14 stress 0.1340864 
... Procrustes: rmse 0.00005354448  max resid 0.0004812305 
... Similar to previous best
Run 15 stress 0.1541014 
Run 16 stress 0.136301 
Run 17 stress 0.1825055 
Run 18 stress 0.1616854 
Run 19 stress 0.1340865 
... Procrustes: rmse 0.00007684543  max resid 0.0006123963 
... Similar to previous best
Run 20 stress 0.1492494 
*** Solution reached</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot ordinations</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">plot_ordination</span>(allday1, ord_unifrac, <span class="at">color =</span> <span class="st">"treat"</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Source, <span class="at">nrow=</span><span class="dv">6</span>)<span class="sc">+</span><span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal)</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">plot_ordination</span>(allday1, ord_unifrac_un, <span class="at">color =</span> <span class="st">"treat"</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>Source, <span class="at">nrow=</span><span class="dv">6</span>)<span class="sc">+</span><span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal)</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>a<span class="sc">+</span>b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="workflow_III_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="bray-dist---different-ordination-methods" class="level3">
<h3 class="anchored" data-anchor-id="bray-dist---different-ordination-methods">Bray dist - Different ordination methods</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">=</span> <span class="st">"bray"</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>ord_meths <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"DCA"</span>, <span class="st">"CCA"</span>, <span class="st">"RDA"</span>, <span class="st">"DPCoA"</span>, <span class="st">"NMDS"</span>, <span class="st">"MDS"</span>, <span class="st">"PCoA"</span>)</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>plist <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">llply</span>(<span class="fu">as.list</span>(ord_meths), <span class="cf">function</span>(i, physeq, dist){</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>        ordi <span class="ot">=</span> <span class="fu">ordinate</span>(physeq, <span class="at">method=</span>i, <span class="at">distance=</span>dist)</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot_ordination</span>(physeq, ordi, <span class="st">"samples"</span>, <span class="at">color=</span><span class="st">"treat"</span>)</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>}, allday1, dist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Square root transformation
Wisconsin double standardization
Run 0 stress 0.1923419 
Run 1 stress 0.1888086 
... New best solution
... Procrustes: rmse 0.04051585  max resid 0.3150244 
Run 2 stress 0.1936263 
Run 3 stress 0.1937171 
Run 4 stress 0.178368 
... New best solution
... Procrustes: rmse 0.02877841  max resid 0.343159 
Run 5 stress 0.1783678 
... New best solution
... Procrustes: rmse 0.00007688511  max resid 0.0006951795 
... Similar to previous best
Run 6 stress 0.1783678 
... New best solution
... Procrustes: rmse 0.00002169268  max resid 0.0002045239 
... Similar to previous best
Run 7 stress 0.1903324 
Run 8 stress 0.1776801 
... New best solution
... Procrustes: rmse 0.007922652  max resid 0.0989642 
Run 9 stress 0.1973401 
Run 10 stress 0.2035121 
Run 11 stress 0.2106701 
Run 12 stress 0.1783688 
Run 13 stress 0.1783688 
Run 14 stress 0.1939602 
Run 15 stress 0.2044188 
Run 16 stress 0.1937156 
Run 17 stress 0.1783677 
Run 18 stress 0.1983849 
Run 19 stress 0.2100802 
Run 20 stress 0.1929314 
*** No convergence -- monoMDS stopping criteria:
    20: stress ratio &gt; sratmax</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(plist) <span class="ot">&lt;-</span> ord_meths</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>pdataframe <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">ldply</span>(plist, <span class="cf">function</span>(x){</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">=</span> x<span class="sc">$</span>data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Axis_1"</span>, <span class="st">"Axis_2"</span>)</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>data))</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pdataframe)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">"method"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>pdataframe<span class="sc">$</span>treat<span class="ot">&lt;-</span> <span class="fu">factor</span>(pdataframe<span class="sc">$</span>treat,</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span><span class="fu">unique</span>(pdataframe<span class="sc">$</span>treat)[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)])</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>pdataframe<span class="sc">$</span>Source <span class="ot">&lt;-</span><span class="fu">factor</span>(pdataframe<span class="sc">$</span>Source,<span class="at">levels =</span><span class="fu">c</span>( <span class="st">"Sto"</span>,<span class="st">"Si2"</span>,<span class="st">"Si3"</span>,<span class="st">"Cae5"</span>,<span class="st">"Co2"</span>,<span class="st">"faecal"</span>))</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fu">ggplot</span>(pdataframe, <span class="fu">aes</span>(Axis_1, Axis_2, <span class="at">color=</span>Source, <span class="at">shape=</span>treat, <span class="at">fill=</span>Source))</span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales=</span><span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="workflow_III_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># + scale_colour_manual(values = mypal) +scale_fill_manual(values = alpha(mypal, 0.2))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="rclr---aitchinson-dist" class="level3">
<h3 class="anchored" data-anchor-id="rclr---aitchinson-dist">Rclr - aitchinson dist</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>my.tree2 <span class="ot">&lt;-</span> <span class="fu">phy_tree</span>(ps_clr)</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>out.group <span class="ot">&lt;-</span> <span class="fu">pick_new_outgroup</span>(my.tree2)</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>out.group <span class="do">## [1] "Seq5638"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Seq5638"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>new.tree2 <span class="ot">&lt;-</span> ape<span class="sc">::</span><span class="fu">root</span>(my.tree2, <span class="at">outgroup=</span>out.group, <span class="at">resolve.root=</span><span class="cn">TRUE</span>)</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="fu">phy_tree</span>(ps_clr) <span class="ot">&lt;-</span> new.tree2</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="fu">phy_tree</span>(ps_clr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Phylogenetic tree with 2444 tips and 2443 internal nodes.

Tip labels:
  Seq67, Seq68, Seq69, Seq70, Seq76, Seq79, ...
Node labels:
  Root, , 0.959, 0.729, 0.702, 0.912, ...

Rooted; includes branch lengths.</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ps_clr</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>ord_unifrac <span class="ot">&lt;-</span> <span class="fu">ordinate</span>(ps_clr, <span class="at">method =</span> <span class="st">"PCoA"</span>, <span class="at">distance =</span> <span class="st">"euclidean"</span>) </span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot ps_clr</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">plot_ordination</span>(ps_clr, ord_unifrac, <span class="at">color =</span> <span class="st">"treat"</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Source, <span class="at">nrow=</span><span class="dv">6</span>)<span class="sc">+</span><span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal)</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">plot_ordination</span>(ps_clr, ord_unifrac_un, <span class="at">color =</span> <span class="st">"treat"</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>Source, <span class="at">nrow=</span><span class="dv">6</span>)<span class="sc">+</span><span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal)</span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>a<span class="sc">+</span>b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="workflow_III_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">=</span> <span class="st">"euclidean"</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>ord_meths <span class="ot">=</span> <span class="fu">c</span>( <span class="st">"RDA"</span>, <span class="st">"MDS"</span>, <span class="st">"PCoA"</span>)</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>plist3 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">llply</span>(<span class="fu">as.list</span>(ord_meths), <span class="cf">function</span>(i, physeq, dist){</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>        ordi <span class="ot">=</span> <span class="fu">ordinate</span>(physeq, <span class="at">method=</span>i, <span class="at">distance=</span>dist)</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot_ordination</span>(physeq, ordi, <span class="st">"samples"</span>, <span class="at">color=</span><span class="st">"treat"</span>)</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>}, ps_clr, dist)</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(plist3) <span class="ot">&lt;-</span> ord_meths</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>pdataframe3 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">ldply</span>(plist3, <span class="cf">function</span>(x){</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">=</span> x<span class="sc">$</span>data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Axis_1"</span>, <span class="st">"Axis_2"</span>)</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>data))</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pdataframe3)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">"method"</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>pdataframe3<span class="sc">$</span>treat<span class="ot">&lt;-</span> <span class="fu">factor</span>(pdataframe3<span class="sc">$</span>treat,</span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span><span class="fu">unique</span>(pdataframe3<span class="sc">$</span>treat)[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)])</span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a>pdataframe3<span class="sc">$</span>Source <span class="ot">&lt;-</span><span class="fu">factor</span>(pdataframe3<span class="sc">$</span>Source,<span class="at">levels =</span><span class="fu">c</span>( <span class="st">"Sto"</span>,<span class="st">"Si2"</span>,<span class="st">"Si3"</span>,<span class="st">"Cae5"</span>,<span class="st">"Co2"</span>,<span class="st">"faecal"</span>))</span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>pdataframe3<span class="sc">|&gt;</span></span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(Axis_1, Axis_2,<span class="at">shape=</span>treat),<span class="at">size=</span><span class="dv">1</span>, <span class="at">alpha =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="fu">aes</span>(Axis_1, Axis_2, <span class="at">colour=</span> Source, <span class="at">label =</span> Source),</span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">geom =</span> <span class="st">"textpath"</span>, <span class="at">hjust =</span> <span class="fu">c</span>(<span class="fl">0.57</span>), <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales=</span><span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb140-20"><a href="#cb140-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal2) <span class="sc">+</span></span>
<span id="cb140-21"><a href="#cb140-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">new_scale_colour</span>()<span class="sc">+</span></span>
<span id="cb140-22"><a href="#cb140-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(Axis_1, Axis_2,<span class="at">colour=</span>treat, <span class="at">shape=</span>treat),<span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb140-23"><a href="#cb140-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="workflow_III_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="ordinate-with-ampviz" class="level1">
<h1>Ordinate with AmpViz</h1>
<section id="whole-dataset" class="level2">
<h2 class="anchored" data-anchor-id="whole-dataset">Whole dataset</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">=</span> <span class="st">"bray"</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>ord_meths <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"PCA"</span>, <span class="st">"RDA"</span>, <span class="st">"CA"</span>, <span class="st">"CCA"</span>, <span class="st">"DCA"</span>, <span class="st">"NMDS"</span>, <span class="st">"PCOA"</span>, <span class="st">"PCOA"</span>)</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>plist2 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">llply</span>(<span class="fu">as.list</span>(ord_meths), <span class="cf">function</span>(i, d, dist){</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>  ordin<span class="ot">&lt;-</span> <span class="fu">amp_ordinate</span>(</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span>d, </span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> i,</span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">filter_species =</span> <span class="fl">0.1</span>,</span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">distmeasure =</span> dist,</span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrain =</span> <span class="fu">c</span>(<span class="st">"PigID"</span>,<span class="st">"Feed"</span>),</span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">transform =</span> <span class="st">"none"</span>,</span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_color_by =</span> <span class="st">"Source"</span>,</span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_shape_by =</span> <span class="st">"Feed"</span>,</span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_colorframe =</span> T,</span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_colorframe_label =</span> <span class="st">"Source"</span>,</span>
<span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">detailed_output =</span> <span class="cn">TRUE</span></span>
<span id="cb141-17"><a href="#cb141-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb141-18"><a href="#cb141-18" aria-hidden="true" tabindex="-1"></a>}, d, dist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>937 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2444 OTUs
After: 1507 OTUs
937 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2444 OTUs
After: 1507 OTUs
937 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2444 OTUs
After: 1507 OTUs
937 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2444 OTUs
After: 1507 OTUs
937 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2444 OTUs
After: 1507 OTUs
937 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2444 OTUs
After: 1507 OTUs</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Performing non-Metric Multidimensional Scaling on more than 100 samples, this may take some time ... </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Done.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>937 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2444 OTUs
After: 1507 OTUs
937 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2444 OTUs
After: 1507 OTUs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(plist2) <span class="ot">&lt;-</span> ord_meths</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>pdataframe2 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">ldply</span>(plist2, <span class="cf">function</span>(x){</span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">=</span> x<span class="sc">$</span>plot<span class="sc">$</span>data[, <span class="dv">36</span><span class="sc">:</span><span class="dv">37</span>]</span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Axis_1"</span>, <span class="st">"Axis_2"</span>)</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>plot<span class="sc">$</span>data[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">12</span><span class="sc">:</span><span class="dv">35</span>)]))</span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pdataframe2)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">"method"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="all-methods-bray" class="level3">
<h3 class="anchored" data-anchor-id="all-methods-bray">all methods Bray</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>pdataframe2<span class="sc">$</span>treat<span class="ot">&lt;-</span> <span class="fu">factor</span>(pdataframe2<span class="sc">$</span>treat,</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span><span class="fu">unique</span>(pdataframe2<span class="sc">$</span>treat)[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)])</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>pdataframe2<span class="sc">$</span>Source <span class="ot">&lt;-</span><span class="fu">factor</span>(pdataframe2<span class="sc">$</span>Source,<span class="at">levels =</span><span class="fu">c</span>( <span class="st">"Sto"</span>,<span class="st">"Si2"</span>,<span class="st">"Si3"</span>,<span class="st">"Cae5"</span>,<span class="st">"Co2"</span>,<span class="st">"faecal"</span>))</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a><span class="co"># p = ggplot(pdataframe2, aes(Axis_1, Axis_2, color=Source, fill=Source))</span></span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a><span class="co"># p + geom_point(size=1) + </span></span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     stat_ellipse(show.legend=FALSE) +</span></span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a><span class="co">#    facet_wrap(~method, scales="free") +</span></span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     scale_colour_manual(values = mypal2) +scale_fill_manual(values = alpha(mypal2, 0.2))</span></span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-13"><a href="#cb147-13" aria-hidden="true" tabindex="-1"></a>pdataframe2<span class="sc">|&gt;</span></span>
<span id="cb147-14"><a href="#cb147-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb147-15"><a href="#cb147-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(Axis_1, Axis_2,<span class="at">shape=</span>treat),<span class="at">size=</span><span class="dv">1</span>, <span class="at">alpha =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb147-16"><a href="#cb147-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="fu">aes</span>(Axis_1, Axis_2, <span class="at">colour=</span> Source, <span class="at">label =</span> Source),</span>
<span id="cb147-17"><a href="#cb147-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">geom =</span> <span class="st">"textpath"</span>, <span class="at">hjust =</span> <span class="fu">c</span>(<span class="fl">0.3</span>), <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb147-18"><a href="#cb147-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales=</span><span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb147-19"><a href="#cb147-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal2) <span class="sc">+</span></span>
<span id="cb147-20"><a href="#cb147-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">new_scale_colour</span>()<span class="sc">+</span></span>
<span id="cb147-21"><a href="#cb147-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(Axis_1, Axis_2,<span class="at">colour=</span>treat, <span class="at">shape=</span>treat),<span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb147-22"><a href="#cb147-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="workflow_III_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>ordinationresult <span class="ot">&lt;-</span> <span class="fu">amp_ordinate</span>(</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>  d, </span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"PCOA"</span>,</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">filter_species =</span> <span class="fl">0.1</span>,</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">distmeasure =</span> <span class="st">"bray"</span>,</span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrain =</span> <span class="fu">c</span>(<span class="st">"PigID"</span>, <span class="st">"Feed"</span>),</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">transform =</span> <span class="st">"none"</span>,</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_color_by =</span> <span class="st">"Source"</span>,</span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_shape_by =</span> <span class="st">"Feed"</span>,</span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_colorframe =</span> T,</span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_colorframe_label =</span> <span class="st">"Source"</span>,</span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">detailed_output =</span> <span class="cn">TRUE</span></span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>937 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2444 OTUs
After: 1507 OTUs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>ordinationresult<span class="sc">$</span>plot<span class="sc">$</span>data<span class="sc">|&gt;</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(PCo1, PCo2,<span class="at">shape=</span>treat),<span class="at">size=</span><span class="dv">1</span>, <span class="at">alpha =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="fu">aes</span>(PCo1, PCo2, <span class="at">colour=</span> Source, <span class="at">label =</span> Source),</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">geom =</span> <span class="st">"textpath"</span>, <span class="at">hjust =</span> <span class="fu">c</span>(<span class="fl">0.3</span>), <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># facet_wrap(~method, scales="free", ncol = 2) +</span></span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal2) <span class="sc">+</span></span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">new_scale_colour</span>()<span class="sc">+</span></span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(PCo1, PCo2,<span class="at">colour=</span>treat, <span class="at">shape=</span>treat),<span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="workflow_III_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ordinationresult$plot$data|&gt;</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plotly::plot_ly(x = ~PCo1, y = ~PCo2, z = ~PCo3, mode = 'text',color = ~Source, text=~treat)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="all-except-fecal-sample" class="level3">
<h3 class="anchored" data-anchor-id="all-except-fecal-sample">All except fecal sample</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>no_faecal_d <span class="ot">&lt;-</span> <span class="fu">amp_filter_samples</span>(d,<span class="sc">!</span>(Source <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"faecal"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>15 samples and 1 OTUs have been filtered 
Before: 165 samples and 2444 OTUs
After: 150 samples and 2443 OTUs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">=</span> <span class="st">"bray"</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>ord_meths <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"PCA"</span>, <span class="st">"RDA"</span>, <span class="st">"CA"</span>, <span class="st">"CCA"</span>, <span class="st">"DCA"</span>, <span class="st">"NMDS"</span>, <span class="st">"PCOA"</span>, <span class="st">"PCOA"</span>)</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>plist4 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">llply</span>(<span class="fu">as.list</span>(ord_meths), <span class="cf">function</span>(i, d, dist){</span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>  ordin<span class="ot">&lt;-</span> <span class="fu">amp_ordinate</span>(</span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span>d, </span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> i,</span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">filter_species =</span> <span class="fl">0.1</span>,</span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">distmeasure =</span> dist,</span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrain =</span> <span class="fu">c</span>(<span class="st">"PigID"</span>,<span class="st">"Feed"</span>),</span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">transform =</span> <span class="st">"none"</span>,</span>
<span id="cb154-12"><a href="#cb154-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_color_by =</span> <span class="st">"Source"</span>,</span>
<span id="cb154-13"><a href="#cb154-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_shape_by =</span> <span class="st">"Feed"</span>,</span>
<span id="cb154-14"><a href="#cb154-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_colorframe =</span> T,</span>
<span id="cb154-15"><a href="#cb154-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_colorframe_label =</span> <span class="st">"Source"</span>,</span>
<span id="cb154-16"><a href="#cb154-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">detailed_output =</span> <span class="cn">TRUE</span></span>
<span id="cb154-17"><a href="#cb154-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb154-18"><a href="#cb154-18" aria-hidden="true" tabindex="-1"></a>}, no_faecal_d, dist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>1020 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2443 OTUs
After: 1423 OTUs</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>1020 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2443 OTUs
After: 1423 OTUs
1020 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2443 OTUs
After: 1423 OTUs
1020 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2443 OTUs
After: 1423 OTUs
1020 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2443 OTUs
After: 1423 OTUs
1020 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2443 OTUs
After: 1423 OTUs</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Performing non-Metric Multidimensional Scaling on more than 100 samples, this may take some time ... </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Done.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>1020 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2443 OTUs
After: 1423 OTUs
1020 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2443 OTUs
After: 1423 OTUs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(plist4) <span class="ot">&lt;-</span> ord_meths</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>pdataframe4 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">ldply</span>(plist4, <span class="cf">function</span>(x){</span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">=</span> x<span class="sc">$</span>plot<span class="sc">$</span>data[, <span class="dv">36</span><span class="sc">:</span><span class="dv">37</span>]</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Axis_1"</span>, <span class="st">"Axis_2"</span>)</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>plot<span class="sc">$</span>data[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">12</span><span class="sc">:</span><span class="dv">35</span>)]))</span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pdataframe4)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">"method"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>pdataframe4<span class="sc">$</span>treat<span class="ot">&lt;-</span> <span class="fu">factor</span>(pdataframe4<span class="sc">$</span>treat,</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span><span class="fu">unique</span>(pdataframe4<span class="sc">$</span>treat)[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)])</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>pdataframe4<span class="sc">$</span>Source <span class="ot">&lt;-</span><span class="fu">factor</span>(pdataframe4<span class="sc">$</span>Source,<span class="at">levels =</span><span class="fu">c</span>( <span class="st">"Sto"</span>,<span class="st">"Si2"</span>,<span class="st">"Si3"</span>,<span class="st">"Cae5"</span>,<span class="st">"Co2"</span>,<span class="st">"faecal"</span>))</span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>pdataframe4<span class="sc">|&gt;</span></span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(Axis_1, Axis_2,<span class="at">shape=</span>treat),<span class="at">size=</span><span class="dv">1</span>, <span class="at">alpha =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="fu">aes</span>(Axis_1, Axis_2, <span class="at">colour=</span> Source, <span class="at">label =</span> Source),</span>
<span id="cb161-10"><a href="#cb161-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">geom =</span> <span class="st">"textpath"</span>, <span class="at">hjust =</span> <span class="fu">c</span>(<span class="fl">0.3</span>), <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb161-11"><a href="#cb161-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales=</span><span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb161-12"><a href="#cb161-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal2) <span class="sc">+</span></span>
<span id="cb161-13"><a href="#cb161-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">new_scale_colour</span>()<span class="sc">+</span></span>
<span id="cb161-14"><a href="#cb161-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(Axis_1, Axis_2,<span class="at">colour=</span>treat, <span class="at">shape=</span>treat),<span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb161-15"><a href="#cb161-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="workflow_III_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="divided-by-segments" class="level3">
<h3 class="anchored" data-anchor-id="divided-by-segments">Divided by segments</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>Sto_d <span class="ot">&lt;-</span> <span class="fu">amp_filter_samples</span>(d,Source <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sto"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>134 samples and 266 OTUs have been filtered 
Before: 165 samples and 2444 OTUs
After: 31 samples and 2178 OTUs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>Si2_d <span class="ot">&lt;-</span> <span class="fu">amp_filter_samples</span>(d,Source <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Si2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>135 samples and 313 OTUs have been filtered 
Before: 165 samples and 2444 OTUs
After: 30 samples and 2131 OTUs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>Si3_d <span class="ot">&lt;-</span> <span class="fu">amp_filter_samples</span>(d,Source <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Si3"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>135 samples and 219 OTUs have been filtered 
Before: 165 samples and 2444 OTUs
After: 30 samples and 2225 OTUs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>Cae5_d <span class="ot">&lt;-</span> <span class="fu">amp_filter_samples</span>(d,Source <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cae5"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>135 samples and 188 OTUs have been filtered 
Before: 165 samples and 2444 OTUs
After: 30 samples and 2256 OTUs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>Co2_d <span class="ot">&lt;-</span> <span class="fu">amp_filter_samples</span>(d,Source <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Co2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>136 samples and 215 OTUs have been filtered 
Before: 165 samples and 2444 OTUs
After: 29 samples and 2229 OTUs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>faecal_d <span class="ot">&lt;-</span> <span class="fu">amp_filter_samples</span>(d,Source <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"faecal"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>150 samples and 941 OTUs have been filtered 
Before: 165 samples and 2444 OTUs
After: 15 samples and 1503 OTUs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>d_segments_list<span class="ot">=</span><span class="fu">list</span>(Sto_d, Si2_d, Si3_d, Cae5_d, Co2_d, faecal_d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>plist5 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">llply</span>(d_segments_list, <span class="cf">function</span>(i){</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>  ordin<span class="ot">&lt;-</span> <span class="fu">amp_ordinate</span>(</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span>i, </span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"PCOA"</span>,</span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">filter_species =</span> <span class="fl">0.1</span>,</span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">distmeasure =</span> <span class="st">"bray"</span>,</span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrain =</span> <span class="fu">c</span>(<span class="st">"PigID"</span>,<span class="st">"Feed"</span>),</span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">transform =</span> <span class="st">"none"</span>,</span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_color_by =</span> <span class="st">"treat"</span>,</span>
<span id="cb175-10"><a href="#cb175-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_shape_by =</span> <span class="st">"Feed"</span>,</span>
<span id="cb175-11"><a href="#cb175-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sample_colorframe = T,</span></span>
<span id="cb175-12"><a href="#cb175-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sample_colorframe_label = "Source",</span></span>
<span id="cb175-13"><a href="#cb175-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">detailed_output =</span> <span class="cn">TRUE</span></span>
<span id="cb175-14"><a href="#cb175-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb175-15"><a href="#cb175-15" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>1575 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2178 OTUs
After: 603 OTUs</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>1639 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2131 OTUs
After: 492 OTUs</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>1405 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2225 OTUs
After: 820 OTUs</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>1373 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2256 OTUs
After: 883 OTUs</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>1437 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 2229 OTUs
After: 792 OTUs</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>949 OTUs not present in more than 0.1% relative abundance in any sample have been filtered 
Before: 1503 OTUs
After: 554 OTUs</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(plist5) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Sto_d"</span>, <span class="st">"Si2_d"</span>, <span class="st">"Si3_d"</span>, <span class="st">"Cae5_d"</span>, <span class="st">"Co2_d"</span>, <span class="st">"faecal_d"</span>)</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>pdataframe5 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">ldply</span>(plist5, <span class="cf">function</span>(x){</span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">=</span> x<span class="sc">$</span>plot<span class="sc">$</span>data[, <span class="dv">36</span><span class="sc">:</span><span class="dv">37</span>]</span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Axis_1"</span>, <span class="st">"Axis_2"</span>)</span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>plot<span class="sc">$</span>data[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">12</span><span class="sc">:</span><span class="dv">35</span>)]))</span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pdataframe5)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">"Segment"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="bray-dist---pca-by-segment" class="level4">
<h4 class="anchored" data-anchor-id="bray-dist---pca-by-segment">Bray dist - PCA, BY SEGMENT</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>pdataframe5<span class="sc">$</span>treat<span class="ot">&lt;-</span> <span class="fu">factor</span>(pdataframe5<span class="sc">$</span>treat,</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span><span class="fu">unique</span>(pdataframe5<span class="sc">$</span>treat)[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)])</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>pdataframe5<span class="sc">$</span>Segment <span class="ot">&lt;-</span><span class="fu">factor</span>(pdataframe5<span class="sc">$</span>Segment,<span class="at">levels =</span><span class="fu">c</span>( <span class="st">"Sto_d"</span>,<span class="st">"Si2_d"</span>,<span class="st">"Si3_d"</span>,<span class="st">"Cae5_d"</span>,<span class="st">"Co2_d"</span>,<span class="st">"faecal_d"</span>))</span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>pdataframe5<span class="sc">|&gt;</span></span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(Axis_1, Axis_2,<span class="at">shape=</span>treat, <span class="at">colour=</span> treat),<span class="at">size=</span><span class="dv">1</span>, <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="fu">aes</span>(Axis_1, Axis_2, <span class="at">colour=</span> treat, <span class="at">label =</span> treat),</span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">geom =</span> <span class="st">"textpath"</span>, <span class="at">hjust =</span> <span class="fu">c</span>(<span class="fl">0.3</span>), <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb183-11"><a href="#cb183-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>Segment, <span class="at">scales=</span><span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb183-12"><a href="#cb183-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Too few points to calculate an ellipse</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing missing values (`geom_textpath()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="workflow_III_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<!-- -->

</section>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb186" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "workflow part III"</span></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb186-9"><a href="#cb186-9" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: inline</span></span>
<span id="cb186-10"><a href="#cb186-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb186-11"><a href="#cb186-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-12"><a href="#cb186-12" aria-hidden="true" tabindex="-1"></a><span class="fu"># Beta diversity</span></span>
<span id="cb186-13"><a href="#cb186-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-14"><a href="#cb186-14" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data prep</span></span>
<span id="cb186-15"><a href="#cb186-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-18"><a href="#cb186-18" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-19"><a href="#cb186-19" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb186-20"><a href="#cb186-20" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb186-21"><a href="#cb186-21" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb186-22"><a href="#cb186-22" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb186-23"><a href="#cb186-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb186-24"><a href="#cb186-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phyloseq)</span>
<span id="cb186-25"><a href="#cb186-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ampvis2)</span>
<span id="cb186-26"><a href="#cb186-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(showtext)</span>
<span id="cb186-27"><a href="#cb186-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb186-28"><a href="#cb186-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan)</span>
<span id="cb186-29"><a href="#cb186-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geomtextpath)</span>
<span id="cb186-30"><a href="#cb186-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggnewscale)</span>
<span id="cb186-31"><a href="#cb186-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb186-32"><a href="#cb186-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-33"><a href="#cb186-33" aria-hidden="true" tabindex="-1"></a>mypal <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#4DBBD5B2"</span>, <span class="st">"#00A087B2"</span>,<span class="st">"#E64B35B2"</span>,<span class="st">"#3C5488B2"</span>)</span>
<span id="cb186-34"><a href="#cb186-34" aria-hidden="true" tabindex="-1"></a>mypal2 <span class="ot">=</span>wesanderson<span class="sc">::</span><span class="fu">wes_palette</span>(<span class="st">"Zissou1"</span>, <span class="dv">6</span>, <span class="at">type =</span> <span class="st">"continuous"</span>)</span>
<span id="cb186-35"><a href="#cb186-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-36"><a href="#cb186-36" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-37"><a href="#cb186-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-38"><a href="#cb186-38" aria-hidden="true" tabindex="-1"></a><span class="in">```{r get.data}</span></span>
<span id="cb186-39"><a href="#cb186-39" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb186-40"><a href="#cb186-40" aria-hidden="true" tabindex="-1"></a>allday1<span class="ot">=</span><span class="fu">readRDS</span>(<span class="st">"ps.rarefied.rds"</span>)</span>
<span id="cb186-41"><a href="#cb186-41" aria-hidden="true" tabindex="-1"></a>ps1.NON_rare<span class="ot">=</span><span class="fu">readRDS</span>(<span class="st">"ps1.NON_rare.rds"</span>)</span>
<span id="cb186-42"><a href="#cb186-42" aria-hidden="true" tabindex="-1"></a>saminfo<span class="ot">=</span><span class="fu">readRDS</span>(<span class="st">"saminfo.rds"</span>)</span>
<span id="cb186-43"><a href="#cb186-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-44"><a href="#cb186-44" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-45"><a href="#cb186-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-46"><a href="#cb186-46" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filter}</span></span>
<span id="cb186-47"><a href="#cb186-47" aria-hidden="true" tabindex="-1"></a><span class="co">#estimating relative abundance on rarefied data</span></span>
<span id="cb186-48"><a href="#cb186-48" aria-hidden="true" tabindex="-1"></a><span class="co"># allday = prune_taxa(taxa_sums(ps.rarefied) &gt; 0, ps.rarefied)</span></span>
<span id="cb186-49"><a href="#cb186-49" aria-hidden="true" tabindex="-1"></a><span class="co"># minTotRelAbun = 0</span></span>
<span id="cb186-50"><a href="#cb186-50" aria-hidden="true" tabindex="-1"></a><span class="co"># x = taxa_sums(allday)</span></span>
<span id="cb186-51"><a href="#cb186-51" aria-hidden="true" tabindex="-1"></a><span class="co"># keepTaxa = taxa_names(allday)[which((x / sum(x)) &gt; minTotRelAbun)]</span></span>
<span id="cb186-52"><a href="#cb186-52" aria-hidden="true" tabindex="-1"></a><span class="co"># allday &lt;- prune_taxa(keepTaxa, allday)</span></span>
<span id="cb186-53"><a href="#cb186-53" aria-hidden="true" tabindex="-1"></a><span class="co"># tax_table(allday) &lt;- tax_table(allday)[,1:6]</span></span>
<span id="cb186-54"><a href="#cb186-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-55"><a href="#cb186-55" aria-hidden="true" tabindex="-1"></a>allday1 <span class="ot">=</span> <span class="fu">prune_taxa</span>(<span class="fu">taxa_sums</span>(allday1) <span class="sc">&gt;</span> <span class="dv">0</span>, allday1)</span>
<span id="cb186-56"><a href="#cb186-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-57"><a href="#cb186-57" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-58"><a href="#cb186-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-61"><a href="#cb186-61" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-62"><a href="#cb186-62" aria-hidden="true" tabindex="-1"></a>pick_new_outgroup <span class="ot">&lt;-</span> <span class="cf">function</span>(tree.unrooted){</span>
<span id="cb186-63"><a href="#cb186-63" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">"magrittr"</span>)</span>
<span id="cb186-64"><a href="#cb186-64" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">"data.table"</span>)</span>
<span id="cb186-65"><a href="#cb186-65" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">"ape"</span>) <span class="co"># ape::Ntip</span></span>
<span id="cb186-66"><a href="#cb186-66" aria-hidden="true" tabindex="-1"></a><span class="co"># tablify parts of tree that we need.</span></span>
<span id="cb186-67"><a href="#cb186-67" aria-hidden="true" tabindex="-1"></a>treeDT <span class="ot">&lt;-</span></span>
<span id="cb186-68"><a href="#cb186-68" aria-hidden="true" tabindex="-1"></a>     <span class="fu">cbind</span>(</span>
<span id="cb186-69"><a href="#cb186-69" aria-hidden="true" tabindex="-1"></a>         <span class="fu">data.table</span>(tree.unrooted<span class="sc">$</span>edge),</span>
<span id="cb186-70"><a href="#cb186-70" aria-hidden="true" tabindex="-1"></a>         <span class="fu">data.table</span>(<span class="at">length =</span> tree.unrooted<span class="sc">$</span>edge.length)</span>
<span id="cb186-71"><a href="#cb186-71" aria-hidden="true" tabindex="-1"></a>     )[<span class="dv">1</span><span class="sc">:</span><span class="fu">Ntip</span>(tree.unrooted)] <span class="sc">%&gt;%</span></span>
<span id="cb186-72"><a href="#cb186-72" aria-hidden="true" tabindex="-1"></a> <span class="fu">cbind</span>(<span class="fu">data.table</span>(<span class="at">id =</span> tree.unrooted<span class="sc">$</span>tip.label))</span>
<span id="cb186-73"><a href="#cb186-73" aria-hidden="true" tabindex="-1"></a> <span class="co"># Take the longest terminal branch as outgroup</span></span>
<span id="cb186-74"><a href="#cb186-74" aria-hidden="true" tabindex="-1"></a> new.outgroup <span class="ot">&lt;-</span> treeDT[<span class="fu">which.max</span>(length)]<span class="sc">$</span>id</span>
<span id="cb186-75"><a href="#cb186-75" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(new.outgroup) }</span>
<span id="cb186-76"><a href="#cb186-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-77"><a href="#cb186-77" aria-hidden="true" tabindex="-1"></a>my.tree <span class="ot">&lt;-</span> <span class="fu">phy_tree</span>(allday1)</span>
<span id="cb186-78"><a href="#cb186-78" aria-hidden="true" tabindex="-1"></a>out.group <span class="ot">&lt;-</span> <span class="fu">pick_new_outgroup</span>(my.tree)</span>
<span id="cb186-79"><a href="#cb186-79" aria-hidden="true" tabindex="-1"></a>out.group <span class="do">## [1] "Seq5638"</span></span>
<span id="cb186-80"><a href="#cb186-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-81"><a href="#cb186-81" aria-hidden="true" tabindex="-1"></a>new.tree <span class="ot">&lt;-</span> ape<span class="sc">::</span><span class="fu">root</span>(my.tree, <span class="at">outgroup=</span>out.group, <span class="at">resolve.root=</span><span class="cn">TRUE</span>)</span>
<span id="cb186-82"><a href="#cb186-82" aria-hidden="true" tabindex="-1"></a><span class="fu">phy_tree</span>(allday1) <span class="ot">&lt;-</span> new.tree</span>
<span id="cb186-83"><a href="#cb186-83" aria-hidden="true" tabindex="-1"></a><span class="fu">phy_tree</span>(allday1)</span>
<span id="cb186-84"><a href="#cb186-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-85"><a href="#cb186-85" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span>  <span class="fu">as.data.frame</span>(<span class="fu">otu_table</span>(allday1))</span>
<span id="cb186-86"><a href="#cb186-86" aria-hidden="true" tabindex="-1"></a>sams <span class="ot">&lt;-</span> <span class="fu">colnames</span>(d1)</span>
<span id="cb186-87"><a href="#cb186-87" aria-hidden="true" tabindex="-1"></a>saminfo<span class="sc">$</span>SampleID <span class="ot">&lt;-</span>  <span class="fu">rownames</span>(saminfo)</span>
<span id="cb186-88"><a href="#cb186-88" aria-hidden="true" tabindex="-1"></a>saminfo <span class="ot">&lt;-</span> saminfo <span class="sc">%&gt;%</span> <span class="fu">relocate</span>(SampleID)</span>
<span id="cb186-89"><a href="#cb186-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-90"><a href="#cb186-90" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> saminfo <span class="sc">%&gt;%</span>  <span class="fu">filter</span>(SampleID <span class="sc">%in%</span> sams)</span>
<span id="cb186-91"><a href="#cb186-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-92"><a href="#cb186-92" aria-hidden="true" tabindex="-1"></a>saminfo<span class="ot">=</span>d2</span>
<span id="cb186-93"><a href="#cb186-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-94"><a href="#cb186-94" aria-hidden="true" tabindex="-1"></a>d3 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(phyloseq<span class="sc">::</span><span class="fu">tax_table</span>(allday1))</span>
<span id="cb186-95"><a href="#cb186-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-96"><a href="#cb186-96" aria-hidden="true" tabindex="-1"></a>d3<span class="sc">$</span>Genus<span class="ot">=</span><span class="fu">recode</span>(d3<span class="sc">$</span>Genus,<span class="st">"NA"</span><span class="ot">=</span><span class="st">"Unclassified bacteria"</span>)</span>
<span id="cb186-97"><a href="#cb186-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-98"><a href="#cb186-98" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">amp_load</span>(</span>
<span id="cb186-99"><a href="#cb186-99" aria-hidden="true" tabindex="-1"></a>  <span class="at">otutable =</span> d1,</span>
<span id="cb186-100"><a href="#cb186-100" aria-hidden="true" tabindex="-1"></a>  <span class="at">metadata =</span> d2,</span>
<span id="cb186-101"><a href="#cb186-101" aria-hidden="true" tabindex="-1"></a>  <span class="at">taxonomy =</span> d3,</span>
<span id="cb186-102"><a href="#cb186-102" aria-hidden="true" tabindex="-1"></a>  <span class="at">tree =</span> new.tree</span>
<span id="cb186-103"><a href="#cb186-103" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb186-104"><a href="#cb186-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-105"><a href="#cb186-105" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-106"><a href="#cb186-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-107"><a href="#cb186-107" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sampling effort correction comparison</span></span>
<span id="cb186-108"><a href="#cb186-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-111"><a href="#cb186-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-112"><a href="#cb186-112" aria-hidden="true" tabindex="-1"></a><span class="do">##allday is the rarefy dataset</span></span>
<span id="cb186-113"><a href="#cb186-113" aria-hidden="true" tabindex="-1"></a><span class="co"># allday1 &lt;- subset_samples(allday1, PigID %in% my_pigs)</span></span>
<span id="cb186-114"><a href="#cb186-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-115"><a href="#cb186-115" aria-hidden="true" tabindex="-1"></a>wunifrac_dist <span class="ot">=</span> phyloseq<span class="sc">::</span><span class="fu">distance</span>(allday1, <span class="at">method=</span><span class="st">"unifrac"</span>, <span class="at">weighted=</span>T)</span>
<span id="cb186-116"><a href="#cb186-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-117"><a href="#cb186-117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-118"><a href="#cb186-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-121"><a href="#cb186-121" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-122"><a href="#cb186-122" aria-hidden="true" tabindex="-1"></a><span class="co">#comparing distances</span></span>
<span id="cb186-123"><a href="#cb186-123" aria-hidden="true" tabindex="-1"></a>                                          </span>
<span id="cb186-124"><a href="#cb186-124" aria-hidden="true" tabindex="-1"></a>group_count <span class="ot">&lt;-</span> ps1.NON_rare<span class="sc">%&gt;%</span></span>
<span id="cb186-125"><a href="#cb186-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">psmelt</span>()<span class="sc">%&gt;%</span> <span class="co"># Melt to long format</span></span>
<span id="cb186-126"><a href="#cb186-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sample,OTU,Abundance)<span class="sc">%&gt;%</span></span>
<span id="cb186-127"><a href="#cb186-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Sample) <span class="sc">%&gt;%</span></span>
<span id="cb186-128"><a href="#cb186-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n_seqs =</span> <span class="fu">sum</span>(Abundance))</span>
<span id="cb186-129"><a href="#cb186-129" aria-hidden="true" tabindex="-1"></a>group_count<span class="sc">$</span>n_seqs <span class="sc">%&gt;%</span> range</span>
<span id="cb186-130"><a href="#cb186-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-131"><a href="#cb186-131" aria-hidden="true" tabindex="-1"></a>rand_df <span class="ot">&lt;-</span> ps1.NON_rare<span class="sc">%&gt;%</span></span>
<span id="cb186-132"><a href="#cb186-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">psmelt</span>()<span class="sc">%&gt;%</span> <span class="co"># Melt to long format</span></span>
<span id="cb186-133"><a href="#cb186-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sample,OTU,Abundance)<span class="sc">%&gt;%</span></span>
<span id="cb186-134"><a href="#cb186-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>OTU, <span class="at">values_from=</span>Abundance, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb186-135"><a href="#cb186-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb186-136"><a href="#cb186-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-137"><a href="#cb186-137" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(rand_df) <span class="ot">&lt;-</span> rand_df<span class="sc">$</span>Sample</span>
<span id="cb186-138"><a href="#cb186-138" aria-hidden="true" tabindex="-1"></a>rand_df <span class="ot">&lt;-</span> rand_df[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb186-139"><a href="#cb186-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-140"><a href="#cb186-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-141"><a href="#cb186-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-142"><a href="#cb186-142" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-143"><a href="#cb186-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-144"><a href="#cb186-144" aria-hidden="true" tabindex="-1"></a><span class="in">```{r aitchison_dist}</span></span>
<span id="cb186-145"><a href="#cb186-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-146"><a href="#cb186-146" aria-hidden="true" tabindex="-1"></a>ps_clr <span class="ot">&lt;-</span> microbiome<span class="sc">::</span><span class="fu">transform</span>(ps1.NON_rare, <span class="st">"clr"</span>)          </span>
<span id="cb186-147"><a href="#cb186-147" aria-hidden="true" tabindex="-1"></a><span class="co"># phyloseq::otu_table(ps1.NON_rare)[1:5, 1:5]</span></span>
<span id="cb186-148"><a href="#cb186-148" aria-hidden="true" tabindex="-1"></a><span class="co"># phyloseq::otu_table(ps_clr)[1:5, 1:5]</span></span>
<span id="cb186-149"><a href="#cb186-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-150"><a href="#cb186-150" aria-hidden="true" tabindex="-1"></a>rclr_df <span class="ot">&lt;-</span> ps_clr<span class="sc">%&gt;%</span></span>
<span id="cb186-151"><a href="#cb186-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">psmelt</span>()<span class="sc">%&gt;%</span> <span class="co"># Melt to long format</span></span>
<span id="cb186-152"><a href="#cb186-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()<span class="sc">%&gt;%</span></span>
<span id="cb186-153"><a href="#cb186-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(OTU,Sample,Abundance) <span class="sc">%&gt;%</span></span>
<span id="cb186-154"><a href="#cb186-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>OTU, <span class="at">values_from=</span>Abundance, <span class="at">values_fill=</span><span class="fu">list</span>(<span class="at">Value =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb186-155"><a href="#cb186-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb186-156"><a href="#cb186-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-157"><a href="#cb186-157" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(rclr_df) <span class="ot">&lt;-</span> rclr_df<span class="sc">$</span>Sample</span>
<span id="cb186-158"><a href="#cb186-158" aria-hidden="true" tabindex="-1"></a>rclr_df <span class="ot">&lt;-</span> rclr_df[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb186-159"><a href="#cb186-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-160"><a href="#cb186-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-161"><a href="#cb186-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-162"><a href="#cb186-162" aria-hidden="true" tabindex="-1"></a><span class="in">```{r dist_calc}</span></span>
<span id="cb186-163"><a href="#cb186-163" aria-hidden="true" tabindex="-1"></a>norare_dist <span class="ot">&lt;-</span> <span class="fu">vegdist</span>(rand_df, <span class="at">method=</span><span class="st">"euclidean"</span>)</span>
<span id="cb186-164"><a href="#cb186-164" aria-hidden="true" tabindex="-1"></a>rare_dist <span class="ot">&lt;-</span> <span class="fu">avgdist</span>(rand_df, <span class="at">dmethod=</span><span class="st">"euclidean"</span>, <span class="at">sample=</span><span class="fu">min</span>(group_count<span class="sc">$</span>n_seqs))</span>
<span id="cb186-165"><a href="#cb186-165" aria-hidden="true" tabindex="-1"></a>rclr_dist <span class="ot">&lt;-</span> <span class="fu">vegdist</span>(rclr_df, <span class="at">method=</span><span class="st">"euclidean"</span>)</span>
<span id="cb186-166"><a href="#cb186-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-167"><a href="#cb186-167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-168"><a href="#cb186-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-169"><a href="#cb186-169" aria-hidden="true" tabindex="-1"></a><span class="in">```{r for_comp_dist}</span></span>
<span id="cb186-170"><a href="#cb186-170" aria-hidden="true" tabindex="-1"></a>wunifrac_dist_tb <span class="ot">&lt;-</span> </span>
<span id="cb186-171"><a href="#cb186-171" aria-hidden="true" tabindex="-1"></a>  wunifrac_dist <span class="sc">%&gt;%</span></span>
<span id="cb186-172"><a href="#cb186-172" aria-hidden="true" tabindex="-1"></a>  as.matrix <span class="sc">%&gt;%</span></span>
<span id="cb186-173"><a href="#cb186-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"sample"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb186-174"><a href="#cb186-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="sc">-</span>sample) <span class="sc">%&gt;%</span></span>
<span id="cb186-175"><a href="#cb186-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">&lt;</span> sample)</span>
<span id="cb186-176"><a href="#cb186-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-177"><a href="#cb186-177" aria-hidden="true" tabindex="-1"></a>norare_dtbl <span class="ot">&lt;-</span> norare_dist <span class="sc">%&gt;%</span></span>
<span id="cb186-178"><a href="#cb186-178" aria-hidden="true" tabindex="-1"></a>  as.matrix <span class="sc">%&gt;%</span></span>
<span id="cb186-179"><a href="#cb186-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"sample"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb186-180"><a href="#cb186-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="sc">-</span>sample) <span class="sc">%&gt;%</span></span>
<span id="cb186-181"><a href="#cb186-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">&lt;</span> sample)</span>
<span id="cb186-182"><a href="#cb186-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-183"><a href="#cb186-183" aria-hidden="true" tabindex="-1"></a>rare_dtbl <span class="ot">&lt;-</span> rare_dist <span class="sc">%&gt;%</span></span>
<span id="cb186-184"><a href="#cb186-184" aria-hidden="true" tabindex="-1"></a>  as.matrix <span class="sc">%&gt;%</span></span>
<span id="cb186-185"><a href="#cb186-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"sample"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb186-186"><a href="#cb186-186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="sc">-</span>sample) <span class="sc">%&gt;%</span></span>
<span id="cb186-187"><a href="#cb186-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">&lt;</span> sample)</span>
<span id="cb186-188"><a href="#cb186-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-189"><a href="#cb186-189" aria-hidden="true" tabindex="-1"></a>rclr_dtbl <span class="ot">&lt;-</span> rclr_dist <span class="sc">%&gt;%</span></span>
<span id="cb186-190"><a href="#cb186-190" aria-hidden="true" tabindex="-1"></a>  as.matrix <span class="sc">%&gt;%</span></span>
<span id="cb186-191"><a href="#cb186-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"sample"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb186-192"><a href="#cb186-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="sc">-</span>sample) <span class="sc">%&gt;%</span></span>
<span id="cb186-193"><a href="#cb186-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">&lt;</span> sample)</span>
<span id="cb186-194"><a href="#cb186-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-195"><a href="#cb186-195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-196"><a href="#cb186-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-197"><a href="#cb186-197" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot_dist}</span></span>
<span id="cb186-198"><a href="#cb186-198" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(norare_dtbl, rare_dtbl, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"sample"</span>, <span class="st">"name"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb186-199"><a href="#cb186-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(., rclr_dtbl, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"sample"</span>, <span class="st">"name"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb186-200"><a href="#cb186-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(., wunifrac_dist_tb, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"sample"</span>, <span class="st">"name"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb186-201"><a href="#cb186-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(., group_count, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"sample"</span> <span class="ot">=</span> <span class="st">"Sample"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb186-202"><a href="#cb186-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(., group_count, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"name"</span> <span class="ot">=</span> <span class="st">"Sample"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb186-203"><a href="#cb186-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diffs =</span> <span class="fu">abs</span>(n_seqs.x <span class="sc">-</span> n_seqs.y)) <span class="sc">%&gt;%</span></span>
<span id="cb186-204"><a href="#cb186-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sample, name, <span class="at">norare=</span>value.x, <span class="at">rare=</span>value.y, <span class="at">rclr=</span>value.x.x, <span class="at">wuni=</span>value.y.y, diffs) <span class="sc">%&gt;%</span></span>
<span id="cb186-205"><a href="#cb186-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">c</span>(norare, rare, rclr, wuni), <span class="at">names_to=</span><span class="st">"method"</span>, <span class="at">values_to=</span><span class="st">"dist"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb186-206"><a href="#cb186-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>diffs, <span class="at">y=</span>dist)) <span class="sc">+</span></span>
<span id="cb186-207"><a href="#cb186-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb186-208"><a href="#cb186-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">nrow=</span><span class="dv">4</span>, <span class="at">scales=</span><span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb186-209"><a href="#cb186-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span>
<span id="cb186-210"><a href="#cb186-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-211"><a href="#cb186-211" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-212"><a href="#cb186-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-213"><a href="#cb186-213" aria-hidden="true" tabindex="-1"></a><span class="in">```{r nmsd_est}</span></span>
<span id="cb186-214"><a href="#cb186-214" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb186-215"><a href="#cb186-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-216"><a href="#cb186-216" aria-hidden="true" tabindex="-1"></a>saminfo <span class="ot">&lt;-</span> saminfo <span class="sc">%&gt;%</span> <span class="fu">mutate_at</span>(<span class="fu">names</span>(saminfo)[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>], as.factor)</span>
<span id="cb186-217"><a href="#cb186-217" aria-hidden="true" tabindex="-1"></a>saminfo<span class="sc">$</span>Source_treat<span class="ot">=</span><span class="fu">interaction</span>(saminfo<span class="sc">$</span>Source,saminfo<span class="sc">$</span>treat)</span>
<span id="cb186-218"><a href="#cb186-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-219"><a href="#cb186-219" aria-hidden="true" tabindex="-1"></a><span class="co">#run and saved </span></span>
<span id="cb186-220"><a href="#cb186-220" aria-hidden="true" tabindex="-1"></a><span class="co"># nmds1 &lt;- metaMDS(wunifrac_dist,k=2, trymax=300, maxit = 2000, smin = 1e-4, sfgrmin = 1e-11, sratmax= 0.99999)</span></span>
<span id="cb186-221"><a href="#cb186-221" aria-hidden="true" tabindex="-1"></a><span class="co"># nmds2 &lt;- metaMDS(norare_dist,k=2, trymax=2000, maxit = 2000, smin = 1e-4, sfgrmin = 1e-11, sratmax= 0.99999)</span></span>
<span id="cb186-222"><a href="#cb186-222" aria-hidden="true" tabindex="-1"></a><span class="co"># nmds3 &lt;- metaMDS(rare_dist,k=2, trymax=500, maxit = 2000, smin = 1e-4, sfgrmin = 1e-11, sratmax= 0.99999)</span></span>
<span id="cb186-223"><a href="#cb186-223" aria-hidden="true" tabindex="-1"></a><span class="co"># nmds4 &lt;- metaMDS(rclr_dist)</span></span>
<span id="cb186-224"><a href="#cb186-224" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(nmds1, "nmds1.rds")</span></span>
<span id="cb186-225"><a href="#cb186-225" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(nmds2, "nmds2.rds")</span></span>
<span id="cb186-226"><a href="#cb186-226" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(nmds3, "nmds3.rds")</span></span>
<span id="cb186-227"><a href="#cb186-227" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(nmds4, "nmds4.rds")</span></span>
<span id="cb186-228"><a href="#cb186-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-229"><a href="#cb186-229" aria-hidden="true" tabindex="-1"></a>nmds1 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"nmds1.rds"</span>)</span>
<span id="cb186-230"><a href="#cb186-230" aria-hidden="true" tabindex="-1"></a>nmds2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"nmds2.rds"</span>)</span>
<span id="cb186-231"><a href="#cb186-231" aria-hidden="true" tabindex="-1"></a>nmds3 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"nmds3.rds"</span>)</span>
<span id="cb186-232"><a href="#cb186-232" aria-hidden="true" tabindex="-1"></a>nmds4 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"nmds4.rds"</span>)</span>
<span id="cb186-233"><a href="#cb186-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-234"><a href="#cb186-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-235"><a href="#cb186-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-236"><a href="#cb186-236" aria-hidden="true" tabindex="-1"></a><span class="fu">### NMDS -W Unifrac distance B diversity</span></span>
<span id="cb186-237"><a href="#cb186-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-238"><a href="#cb186-238" aria-hidden="true" tabindex="-1"></a><span class="in">```{r w_unifrac}</span></span>
<span id="cb186-239"><a href="#cb186-239" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb186-240"><a href="#cb186-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-241"><a href="#cb186-241" aria-hidden="true" tabindex="-1"></a><span class="co"># stress &lt;- nmds$stress</span></span>
<span id="cb186-242"><a href="#cb186-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-243"><a href="#cb186-243" aria-hidden="true" tabindex="-1"></a>metadata_nmds <span class="ot">&lt;-</span> vegan<span class="sc">::</span><span class="fu">scores</span>(nmds1, <span class="at">display=</span><span class="st">"site"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb186-244"><a href="#cb186-244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"samples"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb186-245"><a href="#cb186-245" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span> (., saminfo, <span class="at">by=</span> <span class="fu">join_by</span>(samples <span class="sc">==</span> SampleID))</span>
<span id="cb186-246"><a href="#cb186-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-247"><a href="#cb186-247" aria-hidden="true" tabindex="-1"></a>centroid <span class="ot">&lt;-</span> metadata_nmds <span class="sc">%&gt;%</span></span>
<span id="cb186-248"><a href="#cb186-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treat, Source) <span class="sc">%&gt;%</span></span>
<span id="cb186-249"><a href="#cb186-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">NMDS1=</span><span class="fu">mean</span>(NMDS1), <span class="at">NMDS2=</span><span class="fu">mean</span>(NMDS2))</span>
<span id="cb186-250"><a href="#cb186-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-251"><a href="#cb186-251" aria-hidden="true" tabindex="-1"></a>beta_plot<span class="ot">=</span>metadata_nmds <span class="sc">%&gt;%</span></span>
<span id="cb186-252"><a href="#cb186-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>NMDS1, <span class="at">y=</span>NMDS2, <span class="at">color=</span>treat)) <span class="sc">+</span></span>
<span id="cb186-253"><a href="#cb186-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb186-254"><a href="#cb186-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">show.legend=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb186-255"><a href="#cb186-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>centroid, <span class="at">size=</span><span class="dv">3</span>, <span class="at">shape=</span><span class="dv">21</span>, <span class="at">color=</span><span class="st">"black"</span>,</span>
<span id="cb186-256"><a href="#cb186-256" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">fill=</span>treat), <span class="at">show.legend=</span><span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb186-257"><a href="#cb186-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal)<span class="sc">+</span></span>
<span id="cb186-258"><a href="#cb186-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> mypal)<span class="sc">+</span></span>
<span id="cb186-259"><a href="#cb186-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Source, <span class="at">nrow=</span><span class="dv">6</span>)</span>
<span id="cb186-260"><a href="#cb186-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-261"><a href="#cb186-261" aria-hidden="true" tabindex="-1"></a>beta_plot</span>
<span id="cb186-262"><a href="#cb186-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-263"><a href="#cb186-263" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(wunifrac_dist<span class="sc">~</span>saminfo<span class="sc">$</span>treat<span class="sc">*</span>saminfo<span class="sc">$</span>Source,</span>
<span id="cb186-264"><a href="#cb186-264" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>PigID)</span>
<span id="cb186-265"><a href="#cb186-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-266"><a href="#cb186-266" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(wunifrac_dist<span class="sc">~</span>saminfo<span class="sc">$</span>Source,</span>
<span id="cb186-267"><a href="#cb186-267" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>PigID)</span>
<span id="cb186-268"><a href="#cb186-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-269"><a href="#cb186-269" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(wunifrac_dist<span class="sc">~</span>saminfo<span class="sc">$</span>treat,</span>
<span id="cb186-270"><a href="#cb186-270" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>batch)</span>
<span id="cb186-271"><a href="#cb186-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-272"><a href="#cb186-272" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(wunifrac_dist, saminfo<span class="sc">$</span>Source)</span>
<span id="cb186-273"><a href="#cb186-273" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span>
<span id="cb186-274"><a href="#cb186-274" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span>
<span id="cb186-275"><a href="#cb186-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-276"><a href="#cb186-276" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(wunifrac_dist, saminfo<span class="sc">$</span>treat)</span>
<span id="cb186-277"><a href="#cb186-277" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span>
<span id="cb186-278"><a href="#cb186-278" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span>
<span id="cb186-279"><a href="#cb186-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-280"><a href="#cb186-280" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(wunifrac_dist, saminfo<span class="sc">$</span>Source_treat)</span>
<span id="cb186-281"><a href="#cb186-281" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span>
<span id="cb186-282"><a href="#cb186-282" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span>
<span id="cb186-283"><a href="#cb186-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-284"><a href="#cb186-284" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-285"><a href="#cb186-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-288"><a href="#cb186-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-289"><a href="#cb186-289" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-290"><a href="#cb186-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-291"><a href="#cb186-291" aria-hidden="true" tabindex="-1"></a><span class="fu">### NMDS -Non rarefy euclidean distance diversity</span></span>
<span id="cb186-292"><a href="#cb186-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-293"><a href="#cb186-293" aria-hidden="true" tabindex="-1"></a><span class="in">```{r non_rare_eucl}</span></span>
<span id="cb186-294"><a href="#cb186-294" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb186-295"><a href="#cb186-295" aria-hidden="true" tabindex="-1"></a><span class="co"># stress &lt;- nmds$stress</span></span>
<span id="cb186-296"><a href="#cb186-296" aria-hidden="true" tabindex="-1"></a>metadata_nmds <span class="ot">&lt;-</span> vegan<span class="sc">::</span><span class="fu">scores</span>(nmds2, <span class="at">display=</span><span class="st">"site"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb186-297"><a href="#cb186-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"samples"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb186-298"><a href="#cb186-298" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span> (., saminfo, <span class="at">by=</span> <span class="fu">join_by</span>(samples <span class="sc">==</span> SampleID))</span>
<span id="cb186-299"><a href="#cb186-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-300"><a href="#cb186-300" aria-hidden="true" tabindex="-1"></a>centroid <span class="ot">&lt;-</span> metadata_nmds <span class="sc">%&gt;%</span></span>
<span id="cb186-301"><a href="#cb186-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treat, Source) <span class="sc">%&gt;%</span></span>
<span id="cb186-302"><a href="#cb186-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">NMDS1=</span><span class="fu">mean</span>(NMDS1), <span class="at">NMDS2=</span><span class="fu">mean</span>(NMDS2))</span>
<span id="cb186-303"><a href="#cb186-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-304"><a href="#cb186-304" aria-hidden="true" tabindex="-1"></a>metadata_nmds <span class="sc">%&gt;%</span></span>
<span id="cb186-305"><a href="#cb186-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>NMDS1, <span class="at">y=</span>NMDS2, <span class="at">color=</span>treat)) <span class="sc">+</span></span>
<span id="cb186-306"><a href="#cb186-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb186-307"><a href="#cb186-307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">show.legend=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb186-308"><a href="#cb186-308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>centroid, <span class="at">size=</span><span class="dv">3</span>, <span class="at">shape=</span><span class="dv">21</span>, <span class="at">color=</span><span class="st">"black"</span>,</span>
<span id="cb186-309"><a href="#cb186-309" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">fill=</span>treat), <span class="at">show.legend=</span><span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb186-310"><a href="#cb186-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal)<span class="sc">+</span></span>
<span id="cb186-311"><a href="#cb186-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> mypal)<span class="sc">+</span></span>
<span id="cb186-312"><a href="#cb186-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Source, <span class="at">nrow=</span><span class="dv">6</span>)</span>
<span id="cb186-313"><a href="#cb186-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-314"><a href="#cb186-314" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(norare_dist<span class="sc">~</span>saminfo<span class="sc">$</span>treat<span class="sc">*</span>saminfo<span class="sc">$</span>Source,</span>
<span id="cb186-315"><a href="#cb186-315" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>PigID)</span>
<span id="cb186-316"><a href="#cb186-316" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(norare_dist<span class="sc">~</span>saminfo<span class="sc">$</span>Source,</span>
<span id="cb186-317"><a href="#cb186-317" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>PigID)</span>
<span id="cb186-318"><a href="#cb186-318" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(norare_dist<span class="sc">~</span>saminfo<span class="sc">$</span>treat,</span>
<span id="cb186-319"><a href="#cb186-319" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>batch)</span>
<span id="cb186-320"><a href="#cb186-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-321"><a href="#cb186-321" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(norare_dist, saminfo<span class="sc">$</span>Source)</span>
<span id="cb186-322"><a href="#cb186-322" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span>
<span id="cb186-323"><a href="#cb186-323" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span>
<span id="cb186-324"><a href="#cb186-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-325"><a href="#cb186-325" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(norare_dist, saminfo<span class="sc">$</span>treat)</span>
<span id="cb186-326"><a href="#cb186-326" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span>
<span id="cb186-327"><a href="#cb186-327" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span>
<span id="cb186-328"><a href="#cb186-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-329"><a href="#cb186-329" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(norare_dist, saminfo<span class="sc">$</span>Source_treat)</span>
<span id="cb186-330"><a href="#cb186-330" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span>
<span id="cb186-331"><a href="#cb186-331" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span>
<span id="cb186-332"><a href="#cb186-332" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-333"><a href="#cb186-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-334"><a href="#cb186-334" aria-hidden="true" tabindex="-1"></a><span class="fu">### NMDS -Rarefy euclidean distance diversity</span></span>
<span id="cb186-335"><a href="#cb186-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-336"><a href="#cb186-336" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rare_eucl}</span></span>
<span id="cb186-337"><a href="#cb186-337" aria-hidden="true" tabindex="-1"></a>metadata_nmds <span class="ot">&lt;-</span> vegan<span class="sc">::</span><span class="fu">scores</span>(nmds3, <span class="at">display=</span><span class="st">"site"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb186-338"><a href="#cb186-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"samples"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb186-339"><a href="#cb186-339" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span> (., saminfo, <span class="at">by=</span> <span class="fu">join_by</span>(samples <span class="sc">==</span> SampleID))</span>
<span id="cb186-340"><a href="#cb186-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-341"><a href="#cb186-341" aria-hidden="true" tabindex="-1"></a>centroid <span class="ot">&lt;-</span> metadata_nmds <span class="sc">%&gt;%</span></span>
<span id="cb186-342"><a href="#cb186-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treat, Source) <span class="sc">%&gt;%</span></span>
<span id="cb186-343"><a href="#cb186-343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">NMDS1=</span><span class="fu">mean</span>(NMDS1), <span class="at">NMDS2=</span><span class="fu">mean</span>(NMDS2))</span>
<span id="cb186-344"><a href="#cb186-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-345"><a href="#cb186-345" aria-hidden="true" tabindex="-1"></a>metadata_nmds <span class="sc">%&gt;%</span></span>
<span id="cb186-346"><a href="#cb186-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>NMDS1, <span class="at">y=</span>NMDS2, <span class="at">color=</span>treat)) <span class="sc">+</span></span>
<span id="cb186-347"><a href="#cb186-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb186-348"><a href="#cb186-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">show.legend=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb186-349"><a href="#cb186-349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>centroid, <span class="at">size=</span><span class="dv">3</span>, <span class="at">shape=</span><span class="dv">21</span>, <span class="at">color=</span><span class="st">"black"</span>,</span>
<span id="cb186-350"><a href="#cb186-350" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">fill=</span>treat), <span class="at">show.legend=</span><span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb186-351"><a href="#cb186-351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal)<span class="sc">+</span></span>
<span id="cb186-352"><a href="#cb186-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> mypal)<span class="sc">+</span></span>
<span id="cb186-353"><a href="#cb186-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Source, <span class="at">nrow=</span><span class="dv">6</span>)</span>
<span id="cb186-354"><a href="#cb186-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-355"><a href="#cb186-355" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(rare_dist<span class="sc">~</span>saminfo<span class="sc">$</span>treat<span class="sc">*</span>saminfo<span class="sc">$</span>Source,</span>
<span id="cb186-356"><a href="#cb186-356" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>PigID)</span>
<span id="cb186-357"><a href="#cb186-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-358"><a href="#cb186-358" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(rare_dist<span class="sc">~</span>saminfo<span class="sc">$</span>Source,</span>
<span id="cb186-359"><a href="#cb186-359" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>PigID)</span>
<span id="cb186-360"><a href="#cb186-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-361"><a href="#cb186-361" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(rare_dist<span class="sc">~</span>saminfo<span class="sc">$</span>treat,</span>
<span id="cb186-362"><a href="#cb186-362" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>batch)</span>
<span id="cb186-363"><a href="#cb186-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-364"><a href="#cb186-364" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(rare_dist, saminfo<span class="sc">$</span>Source)</span>
<span id="cb186-365"><a href="#cb186-365" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span>
<span id="cb186-366"><a href="#cb186-366" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span>
<span id="cb186-367"><a href="#cb186-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-368"><a href="#cb186-368" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(rare_dist, saminfo<span class="sc">$</span>treat)</span>
<span id="cb186-369"><a href="#cb186-369" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span>
<span id="cb186-370"><a href="#cb186-370" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span>
<span id="cb186-371"><a href="#cb186-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-372"><a href="#cb186-372" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(rare_dist, saminfo<span class="sc">$</span>Source_treat)</span>
<span id="cb186-373"><a href="#cb186-373" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span>
<span id="cb186-374"><a href="#cb186-374" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span>
<span id="cb186-375"><a href="#cb186-375" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-376"><a href="#cb186-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-377"><a href="#cb186-377" aria-hidden="true" tabindex="-1"></a><span class="fu">### NMDS -Robust CLR euclidean distance diversity</span></span>
<span id="cb186-378"><a href="#cb186-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-379"><a href="#cb186-379" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rclr_dist_not}</span></span>
<span id="cb186-380"><a href="#cb186-380" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan)</span>
<span id="cb186-381"><a href="#cb186-381" aria-hidden="true" tabindex="-1"></a><span class="co"># stress &lt;- nmds$stress</span></span>
<span id="cb186-382"><a href="#cb186-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-383"><a href="#cb186-383" aria-hidden="true" tabindex="-1"></a>metadata_nmds <span class="ot">&lt;-</span> vegan<span class="sc">::</span><span class="fu">scores</span>(nmds4, <span class="at">display=</span><span class="st">"site"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb186-384"><a href="#cb186-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"samples"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb186-385"><a href="#cb186-385" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span> (., saminfo, <span class="at">by=</span> <span class="fu">join_by</span>(samples <span class="sc">==</span> SampleID))</span>
<span id="cb186-386"><a href="#cb186-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-387"><a href="#cb186-387" aria-hidden="true" tabindex="-1"></a>centroid <span class="ot">&lt;-</span> metadata_nmds <span class="sc">%&gt;%</span></span>
<span id="cb186-388"><a href="#cb186-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treat, Source) <span class="sc">%&gt;%</span></span>
<span id="cb186-389"><a href="#cb186-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">NMDS1=</span><span class="fu">mean</span>(NMDS1), <span class="at">NMDS2=</span><span class="fu">mean</span>(NMDS2))</span>
<span id="cb186-390"><a href="#cb186-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-391"><a href="#cb186-391" aria-hidden="true" tabindex="-1"></a>metadata_nmds <span class="sc">%&gt;%</span></span>
<span id="cb186-392"><a href="#cb186-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>NMDS1, <span class="at">y=</span>NMDS2, <span class="at">color=</span>treat)) <span class="sc">+</span></span>
<span id="cb186-393"><a href="#cb186-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb186-394"><a href="#cb186-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">show.legend=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb186-395"><a href="#cb186-395" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>centroid, <span class="at">size=</span><span class="dv">3</span>, <span class="at">shape=</span><span class="dv">21</span>, <span class="at">color=</span><span class="st">"black"</span>,</span>
<span id="cb186-396"><a href="#cb186-396" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">fill=</span>treat), <span class="at">show.legend=</span><span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb186-397"><a href="#cb186-397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal)<span class="sc">+</span></span>
<span id="cb186-398"><a href="#cb186-398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> mypal)<span class="sc">+</span></span>
<span id="cb186-399"><a href="#cb186-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Source, <span class="at">nrow=</span><span class="dv">6</span>)</span>
<span id="cb186-400"><a href="#cb186-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-401"><a href="#cb186-401" aria-hidden="true" tabindex="-1"></a>beta_plot</span>
<span id="cb186-402"><a href="#cb186-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-403"><a href="#cb186-403" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(rclr_dist<span class="sc">~</span>saminfo<span class="sc">$</span>treat<span class="sc">*</span>saminfo<span class="sc">$</span>Source,</span>
<span id="cb186-404"><a href="#cb186-404" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>PigID)</span>
<span id="cb186-405"><a href="#cb186-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-406"><a href="#cb186-406" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(rclr_dist<span class="sc">~</span>saminfo<span class="sc">$</span>Source,</span>
<span id="cb186-407"><a href="#cb186-407" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>PigID)</span>
<span id="cb186-408"><a href="#cb186-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-409"><a href="#cb186-409" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(rclr_dist<span class="sc">~</span>saminfo<span class="sc">$</span>treat,</span>
<span id="cb186-410"><a href="#cb186-410" aria-hidden="true" tabindex="-1"></a>       <span class="at">strata=</span>saminfo<span class="sc">$</span>batch)</span>
<span id="cb186-411"><a href="#cb186-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-412"><a href="#cb186-412" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(rclr_dist, saminfo<span class="sc">$</span>Source)</span>
<span id="cb186-413"><a href="#cb186-413" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span>
<span id="cb186-414"><a href="#cb186-414" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span>
<span id="cb186-415"><a href="#cb186-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-416"><a href="#cb186-416" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(rclr_dist, saminfo<span class="sc">$</span>treat)</span>
<span id="cb186-417"><a href="#cb186-417" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span>
<span id="cb186-418"><a href="#cb186-418" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span>
<span id="cb186-419"><a href="#cb186-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-420"><a href="#cb186-420" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(rclr_dist, saminfo<span class="sc">$</span>Source_treat)</span>
<span id="cb186-421"><a href="#cb186-421" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bd)</span>
<span id="cb186-422"><a href="#cb186-422" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(bd)</span>
<span id="cb186-423"><a href="#cb186-423" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-424"><a href="#cb186-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-425"><a href="#cb186-425" aria-hidden="true" tabindex="-1"></a><span class="fu">## Ordinate with Phyloseq</span></span>
<span id="cb186-426"><a href="#cb186-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-427"><a href="#cb186-427" aria-hidden="true" tabindex="-1"></a><span class="fu">### NMDS - Unifrac dist</span></span>
<span id="cb186-428"><a href="#cb186-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-431"><a href="#cb186-431" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-432"><a href="#cb186-432" aria-hidden="true" tabindex="-1"></a><span class="co">#Generate distances</span></span>
<span id="cb186-433"><a href="#cb186-433" aria-hidden="true" tabindex="-1"></a>ord_unifrac <span class="ot">&lt;-</span> <span class="fu">ordinate</span>(allday1, <span class="at">method =</span> <span class="st">"NMDS"</span>, <span class="at">distance =</span> <span class="st">"wunifrac"</span>) </span>
<span id="cb186-434"><a href="#cb186-434" aria-hidden="true" tabindex="-1"></a>ord_unifrac_un <span class="ot">&lt;-</span> <span class="fu">ordinate</span>(allday1, <span class="at">method =</span> <span class="st">"NMDS"</span>, <span class="at">distance =</span> <span class="st">"unifrac"</span>)   </span>
<span id="cb186-435"><a href="#cb186-435" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot ordinations</span></span>
<span id="cb186-436"><a href="#cb186-436" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">plot_ordination</span>(allday1, ord_unifrac, <span class="at">color =</span> <span class="st">"treat"</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb186-437"><a href="#cb186-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Source, <span class="at">nrow=</span><span class="dv">6</span>)<span class="sc">+</span><span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal)</span>
<span id="cb186-438"><a href="#cb186-438" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">plot_ordination</span>(allday1, ord_unifrac_un, <span class="at">color =</span> <span class="st">"treat"</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb186-439"><a href="#cb186-439" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>Source, <span class="at">nrow=</span><span class="dv">6</span>)<span class="sc">+</span><span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal)</span>
<span id="cb186-440"><a href="#cb186-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-441"><a href="#cb186-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-442"><a href="#cb186-442" aria-hidden="true" tabindex="-1"></a>a<span class="sc">+</span>b</span>
<span id="cb186-443"><a href="#cb186-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-444"><a href="#cb186-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-445"><a href="#cb186-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-446"><a href="#cb186-446" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bray dist - Different ordination methods</span></span>
<span id="cb186-447"><a href="#cb186-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-450"><a href="#cb186-450" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-451"><a href="#cb186-451" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">=</span> <span class="st">"bray"</span></span>
<span id="cb186-452"><a href="#cb186-452" aria-hidden="true" tabindex="-1"></a>ord_meths <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"DCA"</span>, <span class="st">"CCA"</span>, <span class="st">"RDA"</span>, <span class="st">"DPCoA"</span>, <span class="st">"NMDS"</span>, <span class="st">"MDS"</span>, <span class="st">"PCoA"</span>)</span>
<span id="cb186-453"><a href="#cb186-453" aria-hidden="true" tabindex="-1"></a>plist <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">llply</span>(<span class="fu">as.list</span>(ord_meths), <span class="cf">function</span>(i, physeq, dist){</span>
<span id="cb186-454"><a href="#cb186-454" aria-hidden="true" tabindex="-1"></a>        ordi <span class="ot">=</span> <span class="fu">ordinate</span>(physeq, <span class="at">method=</span>i, <span class="at">distance=</span>dist)</span>
<span id="cb186-455"><a href="#cb186-455" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot_ordination</span>(physeq, ordi, <span class="st">"samples"</span>, <span class="at">color=</span><span class="st">"treat"</span>)</span>
<span id="cb186-456"><a href="#cb186-456" aria-hidden="true" tabindex="-1"></a>}, allday1, dist)</span>
<span id="cb186-457"><a href="#cb186-457" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(plist) <span class="ot">&lt;-</span> ord_meths</span>
<span id="cb186-458"><a href="#cb186-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-459"><a href="#cb186-459" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-460"><a href="#cb186-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-463"><a href="#cb186-463" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-464"><a href="#cb186-464" aria-hidden="true" tabindex="-1"></a>pdataframe <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">ldply</span>(plist, <span class="cf">function</span>(x){</span>
<span id="cb186-465"><a href="#cb186-465" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">=</span> x<span class="sc">$</span>data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb186-466"><a href="#cb186-466" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Axis_1"</span>, <span class="st">"Axis_2"</span>)</span>
<span id="cb186-467"><a href="#cb186-467" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>data))</span>
<span id="cb186-468"><a href="#cb186-468" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb186-469"><a href="#cb186-469" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pdataframe)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">"method"</span></span>
<span id="cb186-470"><a href="#cb186-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-471"><a href="#cb186-471" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-472"><a href="#cb186-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-475"><a href="#cb186-475" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-476"><a href="#cb186-476" aria-hidden="true" tabindex="-1"></a>pdataframe<span class="sc">$</span>treat<span class="ot">&lt;-</span> <span class="fu">factor</span>(pdataframe<span class="sc">$</span>treat,</span>
<span id="cb186-477"><a href="#cb186-477" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span><span class="fu">unique</span>(pdataframe<span class="sc">$</span>treat)[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)])</span>
<span id="cb186-478"><a href="#cb186-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-479"><a href="#cb186-479" aria-hidden="true" tabindex="-1"></a>pdataframe<span class="sc">$</span>Source <span class="ot">&lt;-</span><span class="fu">factor</span>(pdataframe<span class="sc">$</span>Source,<span class="at">levels =</span><span class="fu">c</span>( <span class="st">"Sto"</span>,<span class="st">"Si2"</span>,<span class="st">"Si3"</span>,<span class="st">"Cae5"</span>,<span class="st">"Co2"</span>,<span class="st">"faecal"</span>))</span>
<span id="cb186-480"><a href="#cb186-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-481"><a href="#cb186-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-482"><a href="#cb186-482" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fu">ggplot</span>(pdataframe, <span class="fu">aes</span>(Axis_1, Axis_2, <span class="at">color=</span>Source, <span class="at">shape=</span>treat, <span class="at">fill=</span>Source))</span>
<span id="cb186-483"><a href="#cb186-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-484"><a href="#cb186-484" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb186-485"><a href="#cb186-485" aria-hidden="true" tabindex="-1"></a>   <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales=</span><span class="st">"free"</span>)</span>
<span id="cb186-486"><a href="#cb186-486" aria-hidden="true" tabindex="-1"></a><span class="co"># + scale_colour_manual(values = mypal) +scale_fill_manual(values = alpha(mypal, 0.2))</span></span>
<span id="cb186-487"><a href="#cb186-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-488"><a href="#cb186-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-489"><a href="#cb186-489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-490"><a href="#cb186-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-491"><a href="#cb186-491" aria-hidden="true" tabindex="-1"></a><span class="fu">### Rclr - aitchinson dist</span></span>
<span id="cb186-492"><a href="#cb186-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-495"><a href="#cb186-495" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-496"><a href="#cb186-496" aria-hidden="true" tabindex="-1"></a>my.tree2 <span class="ot">&lt;-</span> <span class="fu">phy_tree</span>(ps_clr)</span>
<span id="cb186-497"><a href="#cb186-497" aria-hidden="true" tabindex="-1"></a>out.group <span class="ot">&lt;-</span> <span class="fu">pick_new_outgroup</span>(my.tree2)</span>
<span id="cb186-498"><a href="#cb186-498" aria-hidden="true" tabindex="-1"></a>out.group <span class="do">## [1] "Seq5638"</span></span>
<span id="cb186-499"><a href="#cb186-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-500"><a href="#cb186-500" aria-hidden="true" tabindex="-1"></a>new.tree2 <span class="ot">&lt;-</span> ape<span class="sc">::</span><span class="fu">root</span>(my.tree2, <span class="at">outgroup=</span>out.group, <span class="at">resolve.root=</span><span class="cn">TRUE</span>)</span>
<span id="cb186-501"><a href="#cb186-501" aria-hidden="true" tabindex="-1"></a><span class="fu">phy_tree</span>(ps_clr) <span class="ot">&lt;-</span> new.tree2</span>
<span id="cb186-502"><a href="#cb186-502" aria-hidden="true" tabindex="-1"></a><span class="fu">phy_tree</span>(ps_clr)</span>
<span id="cb186-503"><a href="#cb186-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-504"><a href="#cb186-504" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-505"><a href="#cb186-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-508"><a href="#cb186-508" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-509"><a href="#cb186-509" aria-hidden="true" tabindex="-1"></a><span class="co"># ps_clr</span></span>
<span id="cb186-510"><a href="#cb186-510" aria-hidden="true" tabindex="-1"></a>ord_unifrac <span class="ot">&lt;-</span> <span class="fu">ordinate</span>(ps_clr, <span class="at">method =</span> <span class="st">"PCoA"</span>, <span class="at">distance =</span> <span class="st">"euclidean"</span>) </span>
<span id="cb186-511"><a href="#cb186-511" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot ps_clr</span></span>
<span id="cb186-512"><a href="#cb186-512" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">plot_ordination</span>(ps_clr, ord_unifrac, <span class="at">color =</span> <span class="st">"treat"</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb186-513"><a href="#cb186-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Source, <span class="at">nrow=</span><span class="dv">6</span>)<span class="sc">+</span><span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal)</span>
<span id="cb186-514"><a href="#cb186-514" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">plot_ordination</span>(ps_clr, ord_unifrac_un, <span class="at">color =</span> <span class="st">"treat"</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb186-515"><a href="#cb186-515" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>Source, <span class="at">nrow=</span><span class="dv">6</span>)<span class="sc">+</span><span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal)</span>
<span id="cb186-516"><a href="#cb186-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-517"><a href="#cb186-517" aria-hidden="true" tabindex="-1"></a>a<span class="sc">+</span>b</span>
<span id="cb186-518"><a href="#cb186-518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-519"><a href="#cb186-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-522"><a href="#cb186-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-523"><a href="#cb186-523" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">=</span> <span class="st">"euclidean"</span></span>
<span id="cb186-524"><a href="#cb186-524" aria-hidden="true" tabindex="-1"></a>ord_meths <span class="ot">=</span> <span class="fu">c</span>( <span class="st">"RDA"</span>, <span class="st">"MDS"</span>, <span class="st">"PCoA"</span>)</span>
<span id="cb186-525"><a href="#cb186-525" aria-hidden="true" tabindex="-1"></a>plist3 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">llply</span>(<span class="fu">as.list</span>(ord_meths), <span class="cf">function</span>(i, physeq, dist){</span>
<span id="cb186-526"><a href="#cb186-526" aria-hidden="true" tabindex="-1"></a>        ordi <span class="ot">=</span> <span class="fu">ordinate</span>(physeq, <span class="at">method=</span>i, <span class="at">distance=</span>dist)</span>
<span id="cb186-527"><a href="#cb186-527" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot_ordination</span>(physeq, ordi, <span class="st">"samples"</span>, <span class="at">color=</span><span class="st">"treat"</span>)</span>
<span id="cb186-528"><a href="#cb186-528" aria-hidden="true" tabindex="-1"></a>}, ps_clr, dist)</span>
<span id="cb186-529"><a href="#cb186-529" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(plist3) <span class="ot">&lt;-</span> ord_meths</span>
<span id="cb186-530"><a href="#cb186-530" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-531"><a href="#cb186-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-534"><a href="#cb186-534" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-535"><a href="#cb186-535" aria-hidden="true" tabindex="-1"></a>pdataframe3 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">ldply</span>(plist3, <span class="cf">function</span>(x){</span>
<span id="cb186-536"><a href="#cb186-536" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">=</span> x<span class="sc">$</span>data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb186-537"><a href="#cb186-537" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Axis_1"</span>, <span class="st">"Axis_2"</span>)</span>
<span id="cb186-538"><a href="#cb186-538" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>data))</span>
<span id="cb186-539"><a href="#cb186-539" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb186-540"><a href="#cb186-540" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pdataframe3)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">"method"</span></span>
<span id="cb186-541"><a href="#cb186-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-542"><a href="#cb186-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-543"><a href="#cb186-543" aria-hidden="true" tabindex="-1"></a>pdataframe3<span class="sc">$</span>treat<span class="ot">&lt;-</span> <span class="fu">factor</span>(pdataframe3<span class="sc">$</span>treat,</span>
<span id="cb186-544"><a href="#cb186-544" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span><span class="fu">unique</span>(pdataframe3<span class="sc">$</span>treat)[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)])</span>
<span id="cb186-545"><a href="#cb186-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-546"><a href="#cb186-546" aria-hidden="true" tabindex="-1"></a>pdataframe3<span class="sc">$</span>Source <span class="ot">&lt;-</span><span class="fu">factor</span>(pdataframe3<span class="sc">$</span>Source,<span class="at">levels =</span><span class="fu">c</span>( <span class="st">"Sto"</span>,<span class="st">"Si2"</span>,<span class="st">"Si3"</span>,<span class="st">"Cae5"</span>,<span class="st">"Co2"</span>,<span class="st">"faecal"</span>))</span>
<span id="cb186-547"><a href="#cb186-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-548"><a href="#cb186-548" aria-hidden="true" tabindex="-1"></a>pdataframe3<span class="sc">|&gt;</span></span>
<span id="cb186-549"><a href="#cb186-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb186-550"><a href="#cb186-550" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(Axis_1, Axis_2,<span class="at">shape=</span>treat),<span class="at">size=</span><span class="dv">1</span>, <span class="at">alpha =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb186-551"><a href="#cb186-551" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="fu">aes</span>(Axis_1, Axis_2, <span class="at">colour=</span> Source, <span class="at">label =</span> Source),</span>
<span id="cb186-552"><a href="#cb186-552" aria-hidden="true" tabindex="-1"></a>                 <span class="at">geom =</span> <span class="st">"textpath"</span>, <span class="at">hjust =</span> <span class="fu">c</span>(<span class="fl">0.57</span>), <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb186-553"><a href="#cb186-553" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales=</span><span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb186-554"><a href="#cb186-554" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal2) <span class="sc">+</span></span>
<span id="cb186-555"><a href="#cb186-555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">new_scale_colour</span>()<span class="sc">+</span></span>
<span id="cb186-556"><a href="#cb186-556" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(Axis_1, Axis_2,<span class="at">colour=</span>treat, <span class="at">shape=</span>treat),<span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb186-557"><a href="#cb186-557" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal) </span>
<span id="cb186-558"><a href="#cb186-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-559"><a href="#cb186-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-560"><a href="#cb186-560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-561"><a href="#cb186-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-562"><a href="#cb186-562" aria-hidden="true" tabindex="-1"></a><span class="fu"># Ordinate with AmpViz</span></span>
<span id="cb186-563"><a href="#cb186-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-564"><a href="#cb186-564" aria-hidden="true" tabindex="-1"></a><span class="fu">## Whole dataset</span></span>
<span id="cb186-565"><a href="#cb186-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-568"><a href="#cb186-568" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-569"><a href="#cb186-569" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">=</span> <span class="st">"bray"</span></span>
<span id="cb186-570"><a href="#cb186-570" aria-hidden="true" tabindex="-1"></a>ord_meths <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"PCA"</span>, <span class="st">"RDA"</span>, <span class="st">"CA"</span>, <span class="st">"CCA"</span>, <span class="st">"DCA"</span>, <span class="st">"NMDS"</span>, <span class="st">"PCOA"</span>, <span class="st">"PCOA"</span>)</span>
<span id="cb186-571"><a href="#cb186-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-572"><a href="#cb186-572" aria-hidden="true" tabindex="-1"></a>plist2 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">llply</span>(<span class="fu">as.list</span>(ord_meths), <span class="cf">function</span>(i, d, dist){</span>
<span id="cb186-573"><a href="#cb186-573" aria-hidden="true" tabindex="-1"></a>  ordin<span class="ot">&lt;-</span> <span class="fu">amp_ordinate</span>(</span>
<span id="cb186-574"><a href="#cb186-574" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span>d, </span>
<span id="cb186-575"><a href="#cb186-575" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> i,</span>
<span id="cb186-576"><a href="#cb186-576" aria-hidden="true" tabindex="-1"></a>  <span class="at">filter_species =</span> <span class="fl">0.1</span>,</span>
<span id="cb186-577"><a href="#cb186-577" aria-hidden="true" tabindex="-1"></a>  <span class="at">distmeasure =</span> dist,</span>
<span id="cb186-578"><a href="#cb186-578" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrain =</span> <span class="fu">c</span>(<span class="st">"PigID"</span>,<span class="st">"Feed"</span>),</span>
<span id="cb186-579"><a href="#cb186-579" aria-hidden="true" tabindex="-1"></a>  <span class="at">transform =</span> <span class="st">"none"</span>,</span>
<span id="cb186-580"><a href="#cb186-580" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_color_by =</span> <span class="st">"Source"</span>,</span>
<span id="cb186-581"><a href="#cb186-581" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_shape_by =</span> <span class="st">"Feed"</span>,</span>
<span id="cb186-582"><a href="#cb186-582" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_colorframe =</span> T,</span>
<span id="cb186-583"><a href="#cb186-583" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_colorframe_label =</span> <span class="st">"Source"</span>,</span>
<span id="cb186-584"><a href="#cb186-584" aria-hidden="true" tabindex="-1"></a>  <span class="at">detailed_output =</span> <span class="cn">TRUE</span></span>
<span id="cb186-585"><a href="#cb186-585" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb186-586"><a href="#cb186-586" aria-hidden="true" tabindex="-1"></a>}, d, dist)</span>
<span id="cb186-587"><a href="#cb186-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-588"><a href="#cb186-588" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(plist2) <span class="ot">&lt;-</span> ord_meths</span>
<span id="cb186-589"><a href="#cb186-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-590"><a href="#cb186-590" aria-hidden="true" tabindex="-1"></a>pdataframe2 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">ldply</span>(plist2, <span class="cf">function</span>(x){</span>
<span id="cb186-591"><a href="#cb186-591" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">=</span> x<span class="sc">$</span>plot<span class="sc">$</span>data[, <span class="dv">36</span><span class="sc">:</span><span class="dv">37</span>]</span>
<span id="cb186-592"><a href="#cb186-592" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Axis_1"</span>, <span class="st">"Axis_2"</span>)</span>
<span id="cb186-593"><a href="#cb186-593" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>plot<span class="sc">$</span>data[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">12</span><span class="sc">:</span><span class="dv">35</span>)]))</span>
<span id="cb186-594"><a href="#cb186-594" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb186-595"><a href="#cb186-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-596"><a href="#cb186-596" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pdataframe2)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">"method"</span></span>
<span id="cb186-597"><a href="#cb186-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-598"><a href="#cb186-598" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-599"><a href="#cb186-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-600"><a href="#cb186-600" aria-hidden="true" tabindex="-1"></a><span class="fu">### all methods Bray</span></span>
<span id="cb186-601"><a href="#cb186-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-604"><a href="#cb186-604" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-605"><a href="#cb186-605" aria-hidden="true" tabindex="-1"></a>pdataframe2<span class="sc">$</span>treat<span class="ot">&lt;-</span> <span class="fu">factor</span>(pdataframe2<span class="sc">$</span>treat,</span>
<span id="cb186-606"><a href="#cb186-606" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span><span class="fu">unique</span>(pdataframe2<span class="sc">$</span>treat)[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)])</span>
<span id="cb186-607"><a href="#cb186-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-608"><a href="#cb186-608" aria-hidden="true" tabindex="-1"></a>pdataframe2<span class="sc">$</span>Source <span class="ot">&lt;-</span><span class="fu">factor</span>(pdataframe2<span class="sc">$</span>Source,<span class="at">levels =</span><span class="fu">c</span>( <span class="st">"Sto"</span>,<span class="st">"Si2"</span>,<span class="st">"Si3"</span>,<span class="st">"Cae5"</span>,<span class="st">"Co2"</span>,<span class="st">"faecal"</span>))</span>
<span id="cb186-609"><a href="#cb186-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-610"><a href="#cb186-610" aria-hidden="true" tabindex="-1"></a><span class="co"># p = ggplot(pdataframe2, aes(Axis_1, Axis_2, color=Source, fill=Source))</span></span>
<span id="cb186-611"><a href="#cb186-611" aria-hidden="true" tabindex="-1"></a><span class="co"># p + geom_point(size=1) + </span></span>
<span id="cb186-612"><a href="#cb186-612" aria-hidden="true" tabindex="-1"></a><span class="co">#     stat_ellipse(show.legend=FALSE) +</span></span>
<span id="cb186-613"><a href="#cb186-613" aria-hidden="true" tabindex="-1"></a><span class="co">#    facet_wrap(~method, scales="free") +</span></span>
<span id="cb186-614"><a href="#cb186-614" aria-hidden="true" tabindex="-1"></a><span class="co">#     scale_colour_manual(values = mypal2) +scale_fill_manual(values = alpha(mypal2, 0.2))</span></span>
<span id="cb186-615"><a href="#cb186-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-616"><a href="#cb186-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-617"><a href="#cb186-617" aria-hidden="true" tabindex="-1"></a>pdataframe2<span class="sc">|&gt;</span></span>
<span id="cb186-618"><a href="#cb186-618" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb186-619"><a href="#cb186-619" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(Axis_1, Axis_2,<span class="at">shape=</span>treat),<span class="at">size=</span><span class="dv">1</span>, <span class="at">alpha =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb186-620"><a href="#cb186-620" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="fu">aes</span>(Axis_1, Axis_2, <span class="at">colour=</span> Source, <span class="at">label =</span> Source),</span>
<span id="cb186-621"><a href="#cb186-621" aria-hidden="true" tabindex="-1"></a>                 <span class="at">geom =</span> <span class="st">"textpath"</span>, <span class="at">hjust =</span> <span class="fu">c</span>(<span class="fl">0.3</span>), <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb186-622"><a href="#cb186-622" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales=</span><span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb186-623"><a href="#cb186-623" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal2) <span class="sc">+</span></span>
<span id="cb186-624"><a href="#cb186-624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">new_scale_colour</span>()<span class="sc">+</span></span>
<span id="cb186-625"><a href="#cb186-625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(Axis_1, Axis_2,<span class="at">colour=</span>treat, <span class="at">shape=</span>treat),<span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb186-626"><a href="#cb186-626" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal) </span>
<span id="cb186-627"><a href="#cb186-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-628"><a href="#cb186-628" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-629"><a href="#cb186-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-632"><a href="#cb186-632" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-633"><a href="#cb186-633" aria-hidden="true" tabindex="-1"></a>ordinationresult <span class="ot">&lt;-</span> <span class="fu">amp_ordinate</span>(</span>
<span id="cb186-634"><a href="#cb186-634" aria-hidden="true" tabindex="-1"></a>  d, </span>
<span id="cb186-635"><a href="#cb186-635" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"PCOA"</span>,</span>
<span id="cb186-636"><a href="#cb186-636" aria-hidden="true" tabindex="-1"></a>  <span class="at">filter_species =</span> <span class="fl">0.1</span>,</span>
<span id="cb186-637"><a href="#cb186-637" aria-hidden="true" tabindex="-1"></a>  <span class="at">distmeasure =</span> <span class="st">"bray"</span>,</span>
<span id="cb186-638"><a href="#cb186-638" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrain =</span> <span class="fu">c</span>(<span class="st">"PigID"</span>, <span class="st">"Feed"</span>),</span>
<span id="cb186-639"><a href="#cb186-639" aria-hidden="true" tabindex="-1"></a>  <span class="at">transform =</span> <span class="st">"none"</span>,</span>
<span id="cb186-640"><a href="#cb186-640" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_color_by =</span> <span class="st">"Source"</span>,</span>
<span id="cb186-641"><a href="#cb186-641" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_shape_by =</span> <span class="st">"Feed"</span>,</span>
<span id="cb186-642"><a href="#cb186-642" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_colorframe =</span> T,</span>
<span id="cb186-643"><a href="#cb186-643" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_colorframe_label =</span> <span class="st">"Source"</span>,</span>
<span id="cb186-644"><a href="#cb186-644" aria-hidden="true" tabindex="-1"></a>  <span class="at">detailed_output =</span> <span class="cn">TRUE</span></span>
<span id="cb186-645"><a href="#cb186-645" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb186-646"><a href="#cb186-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-647"><a href="#cb186-647" aria-hidden="true" tabindex="-1"></a>ordinationresult<span class="sc">$</span>plot<span class="sc">$</span>data<span class="sc">|&gt;</span></span>
<span id="cb186-648"><a href="#cb186-648" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb186-649"><a href="#cb186-649" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(PCo1, PCo2,<span class="at">shape=</span>treat),<span class="at">size=</span><span class="dv">1</span>, <span class="at">alpha =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb186-650"><a href="#cb186-650" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="fu">aes</span>(PCo1, PCo2, <span class="at">colour=</span> Source, <span class="at">label =</span> Source),</span>
<span id="cb186-651"><a href="#cb186-651" aria-hidden="true" tabindex="-1"></a>                 <span class="at">geom =</span> <span class="st">"textpath"</span>, <span class="at">hjust =</span> <span class="fu">c</span>(<span class="fl">0.3</span>), <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb186-652"><a href="#cb186-652" aria-hidden="true" tabindex="-1"></a>    <span class="co"># facet_wrap(~method, scales="free", ncol = 2) +</span></span>
<span id="cb186-653"><a href="#cb186-653" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal2) <span class="sc">+</span></span>
<span id="cb186-654"><a href="#cb186-654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">new_scale_colour</span>()<span class="sc">+</span></span>
<span id="cb186-655"><a href="#cb186-655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(PCo1, PCo2,<span class="at">colour=</span>treat, <span class="at">shape=</span>treat),<span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb186-656"><a href="#cb186-656" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal) </span>
<span id="cb186-657"><a href="#cb186-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-658"><a href="#cb186-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-659"><a href="#cb186-659" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-660"><a href="#cb186-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-663"><a href="#cb186-663" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-664"><a href="#cb186-664" aria-hidden="true" tabindex="-1"></a><span class="co">#ordinationresult$plot$data|&gt;</span></span>
<span id="cb186-665"><a href="#cb186-665" aria-hidden="true" tabindex="-1"></a><span class="co"># plotly::plot_ly(x = ~PCo1, y = ~PCo2, z = ~PCo3, mode = 'text',color = ~Source, text=~treat)</span></span>
<span id="cb186-666"><a href="#cb186-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-667"><a href="#cb186-667" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-668"><a href="#cb186-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-669"><a href="#cb186-669" aria-hidden="true" tabindex="-1"></a><span class="fu">### All except fecal sample</span></span>
<span id="cb186-670"><a href="#cb186-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-673"><a href="#cb186-673" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-674"><a href="#cb186-674" aria-hidden="true" tabindex="-1"></a>no_faecal_d <span class="ot">&lt;-</span> <span class="fu">amp_filter_samples</span>(d,<span class="sc">!</span>(Source <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"faecal"</span>)))</span>
<span id="cb186-675"><a href="#cb186-675" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">=</span> <span class="st">"bray"</span></span>
<span id="cb186-676"><a href="#cb186-676" aria-hidden="true" tabindex="-1"></a>ord_meths <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"PCA"</span>, <span class="st">"RDA"</span>, <span class="st">"CA"</span>, <span class="st">"CCA"</span>, <span class="st">"DCA"</span>, <span class="st">"NMDS"</span>, <span class="st">"PCOA"</span>, <span class="st">"PCOA"</span>)</span>
<span id="cb186-677"><a href="#cb186-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-678"><a href="#cb186-678" aria-hidden="true" tabindex="-1"></a>plist4 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">llply</span>(<span class="fu">as.list</span>(ord_meths), <span class="cf">function</span>(i, d, dist){</span>
<span id="cb186-679"><a href="#cb186-679" aria-hidden="true" tabindex="-1"></a>  ordin<span class="ot">&lt;-</span> <span class="fu">amp_ordinate</span>(</span>
<span id="cb186-680"><a href="#cb186-680" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span>d, </span>
<span id="cb186-681"><a href="#cb186-681" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> i,</span>
<span id="cb186-682"><a href="#cb186-682" aria-hidden="true" tabindex="-1"></a>  <span class="at">filter_species =</span> <span class="fl">0.1</span>,</span>
<span id="cb186-683"><a href="#cb186-683" aria-hidden="true" tabindex="-1"></a>  <span class="at">distmeasure =</span> dist,</span>
<span id="cb186-684"><a href="#cb186-684" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrain =</span> <span class="fu">c</span>(<span class="st">"PigID"</span>,<span class="st">"Feed"</span>),</span>
<span id="cb186-685"><a href="#cb186-685" aria-hidden="true" tabindex="-1"></a>  <span class="at">transform =</span> <span class="st">"none"</span>,</span>
<span id="cb186-686"><a href="#cb186-686" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_color_by =</span> <span class="st">"Source"</span>,</span>
<span id="cb186-687"><a href="#cb186-687" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_shape_by =</span> <span class="st">"Feed"</span>,</span>
<span id="cb186-688"><a href="#cb186-688" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_colorframe =</span> T,</span>
<span id="cb186-689"><a href="#cb186-689" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_colorframe_label =</span> <span class="st">"Source"</span>,</span>
<span id="cb186-690"><a href="#cb186-690" aria-hidden="true" tabindex="-1"></a>  <span class="at">detailed_output =</span> <span class="cn">TRUE</span></span>
<span id="cb186-691"><a href="#cb186-691" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb186-692"><a href="#cb186-692" aria-hidden="true" tabindex="-1"></a>}, no_faecal_d, dist)</span>
<span id="cb186-693"><a href="#cb186-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-694"><a href="#cb186-694" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(plist4) <span class="ot">&lt;-</span> ord_meths</span>
<span id="cb186-695"><a href="#cb186-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-696"><a href="#cb186-696" aria-hidden="true" tabindex="-1"></a>pdataframe4 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">ldply</span>(plist4, <span class="cf">function</span>(x){</span>
<span id="cb186-697"><a href="#cb186-697" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">=</span> x<span class="sc">$</span>plot<span class="sc">$</span>data[, <span class="dv">36</span><span class="sc">:</span><span class="dv">37</span>]</span>
<span id="cb186-698"><a href="#cb186-698" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Axis_1"</span>, <span class="st">"Axis_2"</span>)</span>
<span id="cb186-699"><a href="#cb186-699" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>plot<span class="sc">$</span>data[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">12</span><span class="sc">:</span><span class="dv">35</span>)]))</span>
<span id="cb186-700"><a href="#cb186-700" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb186-701"><a href="#cb186-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-702"><a href="#cb186-702" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pdataframe4)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">"method"</span></span>
<span id="cb186-703"><a href="#cb186-703" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-704"><a href="#cb186-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-707"><a href="#cb186-707" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-708"><a href="#cb186-708" aria-hidden="true" tabindex="-1"></a>pdataframe4<span class="sc">$</span>treat<span class="ot">&lt;-</span> <span class="fu">factor</span>(pdataframe4<span class="sc">$</span>treat,</span>
<span id="cb186-709"><a href="#cb186-709" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span><span class="fu">unique</span>(pdataframe4<span class="sc">$</span>treat)[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)])</span>
<span id="cb186-710"><a href="#cb186-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-711"><a href="#cb186-711" aria-hidden="true" tabindex="-1"></a>pdataframe4<span class="sc">$</span>Source <span class="ot">&lt;-</span><span class="fu">factor</span>(pdataframe4<span class="sc">$</span>Source,<span class="at">levels =</span><span class="fu">c</span>( <span class="st">"Sto"</span>,<span class="st">"Si2"</span>,<span class="st">"Si3"</span>,<span class="st">"Cae5"</span>,<span class="st">"Co2"</span>,<span class="st">"faecal"</span>))</span>
<span id="cb186-712"><a href="#cb186-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-713"><a href="#cb186-713" aria-hidden="true" tabindex="-1"></a>pdataframe4<span class="sc">|&gt;</span></span>
<span id="cb186-714"><a href="#cb186-714" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb186-715"><a href="#cb186-715" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(Axis_1, Axis_2,<span class="at">shape=</span>treat),<span class="at">size=</span><span class="dv">1</span>, <span class="at">alpha =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb186-716"><a href="#cb186-716" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="fu">aes</span>(Axis_1, Axis_2, <span class="at">colour=</span> Source, <span class="at">label =</span> Source),</span>
<span id="cb186-717"><a href="#cb186-717" aria-hidden="true" tabindex="-1"></a>                 <span class="at">geom =</span> <span class="st">"textpath"</span>, <span class="at">hjust =</span> <span class="fu">c</span>(<span class="fl">0.3</span>), <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb186-718"><a href="#cb186-718" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales=</span><span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb186-719"><a href="#cb186-719" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal2) <span class="sc">+</span></span>
<span id="cb186-720"><a href="#cb186-720" aria-hidden="true" tabindex="-1"></a>  <span class="fu">new_scale_colour</span>()<span class="sc">+</span></span>
<span id="cb186-721"><a href="#cb186-721" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(Axis_1, Axis_2,<span class="at">colour=</span>treat, <span class="at">shape=</span>treat),<span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb186-722"><a href="#cb186-722" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal) </span>
<span id="cb186-723"><a href="#cb186-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-724"><a href="#cb186-724" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-725"><a href="#cb186-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-726"><a href="#cb186-726" aria-hidden="true" tabindex="-1"></a><span class="fu">### Divided by segments</span></span>
<span id="cb186-727"><a href="#cb186-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-730"><a href="#cb186-730" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-731"><a href="#cb186-731" aria-hidden="true" tabindex="-1"></a>Sto_d <span class="ot">&lt;-</span> <span class="fu">amp_filter_samples</span>(d,Source <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sto"</span>))</span>
<span id="cb186-732"><a href="#cb186-732" aria-hidden="true" tabindex="-1"></a>Si2_d <span class="ot">&lt;-</span> <span class="fu">amp_filter_samples</span>(d,Source <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Si2"</span>))</span>
<span id="cb186-733"><a href="#cb186-733" aria-hidden="true" tabindex="-1"></a>Si3_d <span class="ot">&lt;-</span> <span class="fu">amp_filter_samples</span>(d,Source <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Si3"</span>))</span>
<span id="cb186-734"><a href="#cb186-734" aria-hidden="true" tabindex="-1"></a>Cae5_d <span class="ot">&lt;-</span> <span class="fu">amp_filter_samples</span>(d,Source <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cae5"</span>))</span>
<span id="cb186-735"><a href="#cb186-735" aria-hidden="true" tabindex="-1"></a>Co2_d <span class="ot">&lt;-</span> <span class="fu">amp_filter_samples</span>(d,Source <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Co2"</span>))</span>
<span id="cb186-736"><a href="#cb186-736" aria-hidden="true" tabindex="-1"></a>faecal_d <span class="ot">&lt;-</span> <span class="fu">amp_filter_samples</span>(d,Source <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"faecal"</span>))</span>
<span id="cb186-737"><a href="#cb186-737" aria-hidden="true" tabindex="-1"></a>d_segments_list<span class="ot">=</span><span class="fu">list</span>(Sto_d, Si2_d, Si3_d, Cae5_d, Co2_d, faecal_d)</span>
<span id="cb186-738"><a href="#cb186-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-739"><a href="#cb186-739" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-740"><a href="#cb186-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-743"><a href="#cb186-743" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-744"><a href="#cb186-744" aria-hidden="true" tabindex="-1"></a>plist5 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">llply</span>(d_segments_list, <span class="cf">function</span>(i){</span>
<span id="cb186-745"><a href="#cb186-745" aria-hidden="true" tabindex="-1"></a>  ordin<span class="ot">&lt;-</span> <span class="fu">amp_ordinate</span>(</span>
<span id="cb186-746"><a href="#cb186-746" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span>i, </span>
<span id="cb186-747"><a href="#cb186-747" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"PCOA"</span>,</span>
<span id="cb186-748"><a href="#cb186-748" aria-hidden="true" tabindex="-1"></a>  <span class="at">filter_species =</span> <span class="fl">0.1</span>,</span>
<span id="cb186-749"><a href="#cb186-749" aria-hidden="true" tabindex="-1"></a>  <span class="at">distmeasure =</span> <span class="st">"bray"</span>,</span>
<span id="cb186-750"><a href="#cb186-750" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrain =</span> <span class="fu">c</span>(<span class="st">"PigID"</span>,<span class="st">"Feed"</span>),</span>
<span id="cb186-751"><a href="#cb186-751" aria-hidden="true" tabindex="-1"></a>  <span class="at">transform =</span> <span class="st">"none"</span>,</span>
<span id="cb186-752"><a href="#cb186-752" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_color_by =</span> <span class="st">"treat"</span>,</span>
<span id="cb186-753"><a href="#cb186-753" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_shape_by =</span> <span class="st">"Feed"</span>,</span>
<span id="cb186-754"><a href="#cb186-754" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sample_colorframe = T,</span></span>
<span id="cb186-755"><a href="#cb186-755" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sample_colorframe_label = "Source",</span></span>
<span id="cb186-756"><a href="#cb186-756" aria-hidden="true" tabindex="-1"></a>  <span class="at">detailed_output =</span> <span class="cn">TRUE</span></span>
<span id="cb186-757"><a href="#cb186-757" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb186-758"><a href="#cb186-758" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb186-759"><a href="#cb186-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-760"><a href="#cb186-760" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(plist5) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Sto_d"</span>, <span class="st">"Si2_d"</span>, <span class="st">"Si3_d"</span>, <span class="st">"Cae5_d"</span>, <span class="st">"Co2_d"</span>, <span class="st">"faecal_d"</span>)</span>
<span id="cb186-761"><a href="#cb186-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-762"><a href="#cb186-762" aria-hidden="true" tabindex="-1"></a>pdataframe5 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">ldply</span>(plist5, <span class="cf">function</span>(x){</span>
<span id="cb186-763"><a href="#cb186-763" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">=</span> x<span class="sc">$</span>plot<span class="sc">$</span>data[, <span class="dv">36</span><span class="sc">:</span><span class="dv">37</span>]</span>
<span id="cb186-764"><a href="#cb186-764" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Axis_1"</span>, <span class="st">"Axis_2"</span>)</span>
<span id="cb186-765"><a href="#cb186-765" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>plot<span class="sc">$</span>data[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">12</span><span class="sc">:</span><span class="dv">35</span>)]))</span>
<span id="cb186-766"><a href="#cb186-766" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb186-767"><a href="#cb186-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-768"><a href="#cb186-768" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pdataframe5)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">"Segment"</span></span>
<span id="cb186-769"><a href="#cb186-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-770"><a href="#cb186-770" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb186-771"><a href="#cb186-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-772"><a href="#cb186-772" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Bray dist - PCA, BY SEGMENT</span></span>
<span id="cb186-773"><a href="#cb186-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-776"><a href="#cb186-776" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb186-777"><a href="#cb186-777" aria-hidden="true" tabindex="-1"></a>pdataframe5<span class="sc">$</span>treat<span class="ot">&lt;-</span> <span class="fu">factor</span>(pdataframe5<span class="sc">$</span>treat,</span>
<span id="cb186-778"><a href="#cb186-778" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span><span class="fu">unique</span>(pdataframe5<span class="sc">$</span>treat)[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)])</span>
<span id="cb186-779"><a href="#cb186-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-780"><a href="#cb186-780" aria-hidden="true" tabindex="-1"></a>pdataframe5<span class="sc">$</span>Segment <span class="ot">&lt;-</span><span class="fu">factor</span>(pdataframe5<span class="sc">$</span>Segment,<span class="at">levels =</span><span class="fu">c</span>( <span class="st">"Sto_d"</span>,<span class="st">"Si2_d"</span>,<span class="st">"Si3_d"</span>,<span class="st">"Cae5_d"</span>,<span class="st">"Co2_d"</span>,<span class="st">"faecal_d"</span>))</span>
<span id="cb186-781"><a href="#cb186-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-782"><a href="#cb186-782" aria-hidden="true" tabindex="-1"></a>pdataframe5<span class="sc">|&gt;</span></span>
<span id="cb186-783"><a href="#cb186-783" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb186-784"><a href="#cb186-784" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(Axis_1, Axis_2,<span class="at">shape=</span>treat, <span class="at">colour=</span> treat),<span class="at">size=</span><span class="dv">1</span>, <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb186-785"><a href="#cb186-785" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="fu">aes</span>(Axis_1, Axis_2, <span class="at">colour=</span> treat, <span class="at">label =</span> treat),</span>
<span id="cb186-786"><a href="#cb186-786" aria-hidden="true" tabindex="-1"></a>                 <span class="at">geom =</span> <span class="st">"textpath"</span>, <span class="at">hjust =</span> <span class="fu">c</span>(<span class="fl">0.3</span>), <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb186-787"><a href="#cb186-787" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>Segment, <span class="at">scales=</span><span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb186-788"><a href="#cb186-788" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> mypal) </span>
<span id="cb186-789"><a href="#cb186-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-790"><a href="#cb186-790" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>